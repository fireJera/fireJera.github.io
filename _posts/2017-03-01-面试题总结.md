===
æœ€é«˜é˜¶æ ‡é¢˜
===

---
title: The interview questions summary
description: This is an introduction to summary of interview questions
#header: é¢è¯•æ€»ç»“
---

å·¥ä½œä¸¤å¹´å¤šï¼Œä¾ç„¶å¯¹é¢è¯•ä¸­çš„æŠ€æœ¯æ„Ÿåˆ°æ‰‹è¶³æ— æªï¼Œä»å¤§å­¦åä¸€ç›´ç©ç‰©ä¸§å¿—ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ä»é¢è¯•é¢˜ä¸­å­¦ä¹ æ¥å¼¥è¡¥ä¹‹å‰çš„å •è½ã€‚è¿™ç¯‡æ–‡ç« å°†è¦å†™å¾ˆé•¿ã€‚

* MVCè®¾è®¡æ¨¡å¼ï¼š

Mï¼šmodelæ•°æ®æºï¼š è´Ÿè´£å­˜å‚¨ï¼Œå®šä¹‰ï¼Œæ“ä½œæ•°æ®
Vï¼šviewå±•ç¤ºç»™ç”¨æˆ·çœ‹ï¼Œè´Ÿè´£ä¸ç”¨æˆ·çš„äº¤äº’
Cï¼šcontrollerå¯ä»¥å’Œmå’Œvç›´æ¥é€šä¿¡ï¼Œvè¦é€šè¿‡ä»£ç†æ¥å’Œcé€šä¿¡ï¼Œmé€šè¿‡kvoæˆ–nsnotificationå’Œcé€šä¿¡ï¼Œmå’Œvä¸èƒ½ç›´æ¥é€šä¿¡ã€‚cè´Ÿè´£å°†mçš„æ•°æ®äº¤ç»™vä½¿ç”¨ã€‚
åœ¨è¿™é‡Œå¯¹MVCã€MVPã€MVVMæœ€ä¸€ä¸‹ç®€å•çš„æ¯”è¾ƒ:
MVC:vå’Œcçš„è€¦åˆåº¦å¾ˆé«˜ï¼Œä¸šåŠ¡é€»è¾‘ä»£ç ä¼šè¢«åˆ†æ•£åˆ°uiå¸ƒå±€ä»£ç ä¸­ï¼Œä¸åˆ©äºå•å…ƒæµ‹è¯•ã€‚cå¾ˆè‡ƒè‚¿ã€‚ä½†æ˜¯ç»´æŠ¤å¯å¼€å‘æˆæœ¬å°ã€‚
MVP:è¿™é‡Œçš„v=cï¼Œå°†ä¸»è¦çš„ä»»åŠ¡åˆ†æ•£åˆ°må’Œpä¸­ï¼Œvçš„åŠŸèƒ½å¾ˆå°‘ï¼Œæµ‹è¯•å˜çš„å¾ˆç®€å•ï¼Œå¼€å‘æ—¶é—´å¢åŠ ï¼Œä»£ç é‡æ˜¯mvcçš„ä¸¤å€ã€‚
MVVM:vm=viewmodelï¼Œv=cï¼Œvæ‰¿æ‹…çš„è´£ä»»æ¯”mvpä¸­çš„vå¤šä¸€ç‚¹ã€‚æ›´åŠ å®¹æ˜“å•å…ƒæµ‹è¯•ï¼Œå¦‚æœä½¿ç”¨ç»‘å®šï¼Œæˆæœ¬è²Œä¼¼æ¯”mvpå°ã€‚
è¿˜æœ‰ä¸€ç§VIPERæ¶æ„ï¼Œhinå¤æ‚ã€‚ä¸åŠ è¯´æ˜ã€‚

* å¾ªç¯å¼•ç”¨:

![retain_cycle_1](https://Jeremy1221.github.io/img/retain_cycle/retain_cycle_1.png)

æˆ‘çš„ç†è§£ï¼šå¯¹è±¡Aå’ŒBäº’ç›¸æŒæœ‰ï¼Œå½“æˆ‘ä»¬æƒ³è¦é”€æ¯Aæ—¶ï¼Œå› ä¸ºAæŒæœ‰Bï¼Œç„¶åæˆ‘ä»¬å›å»å°è¯•é”€æ¯Bï¼Œæ­¤æ—¶æˆ‘ä»¬å‘ç°BåˆæŒæœ‰Aï¼Œç„¶åæˆ‘ä»¬æœ‰å°è¯•å»é”€æ¯Bã€‚å¦‚æ­¤å¾ªç¯ä¸‹æ¥æˆ‘ä»¬å°±æ²¡æ³•é”€æ¯ä»»ä½•ä¸€ä¸ªã€‚

![retain_cycle_2](https://Jeremy1221.github.io/img/retain_cycle/retain_cycle_2.png)

å¦‚æœå¤šä¸ªå¯¹è±¡ä¹‹é—´å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå¯¹è±¡è¶Šå¤šï¼Œç¯è¶Šå¤§ï¼Œå°±è¶Šéš¾å‘ç°è¿™ä¸ªé—®é¢˜ã€‚

* çº¿ç¨‹ä¸è¿›ç¨‹

ä¸€ä¸ªç¨‹åºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚
è¿›ç¨‹æ˜¯*èµ„æº*åˆ†é…çš„æœ€å°ç‹¬ç«‹å•å…ƒ
ä¸€ä¸ªçº¿ç¨‹æ­»äº†ï¼Œè¿™ä¸ªè¿›ç¨‹å°±æ­»äº†ï¼Œä½†æ˜¯è¿›ç¨‹é—´æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºè¿›ç¨‹æœ‰è‡ªå·±çš„ç‹¬ç«‹åœ°å€ç©ºé—´ï¼Œæ‰€ä»¥è¿›ç¨‹æ¯”è¾ƒå®‰å…¨ï¼Œä½†æ˜¯è¿›ç¨‹é—´åˆ‡æ¢æ¶ˆè€—èµ„æºå¤§ï¼Œæ•ˆç‡å·®ã€‚
è¦æ±‚åŒæ—¶è¿›è¡Œå¹¶ä¸”å…±äº«èµ„æºçš„æ—¶å€™åªèƒ½ç”¨çº¿ç¨‹ï¼Œä¸èƒ½ç”¨è¿›ç¨‹ã€‚è¿›ç¨‹ä¹Ÿå¯ä»¥å…±äº«èµ„æºï¼Œä½†æ˜¯ä¸èƒ½åŒæ—¶è¿›è¡Œã€‚

* LayoutSubViewsåœ¨ä»€ä¹ˆæ—¶å€™è¢«è°ƒç”¨ï¼Ÿ

å½“Viewæœ¬èº«çš„frameæ”¹å˜æ—¶ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚

* loadView

controllerçš„viewä¸ºnilæ—¶ä¼šè°ƒç”¨ï¼ŒviewDidLoadåœ¨viewä»nibæ–‡ä»¶åˆå§‹åŒ–æ—¶è°ƒç”¨

* __blockå’Œ__weak

ä¸æƒ³å†äº†è§£äº†ï¼Œå› ä¸ºç°åœ¨ä¸»è¦åœ¨å­¦ä¹ swiftã€‚

* å †å’Œæ ˆ

æ ˆåŒºæ˜¯ç”±ç³»ç»Ÿè‡ªè¡Œç®¡ç†çš„ï¼Œå †æ˜¯ç¨‹åºå‘˜æ¥ç®¡ç†çš„
æ ˆæ˜¯è¿ç»­çš„ï¼Œå †æ˜¯ä¸è¿ç»­çš„æ‰€ä»¥ä¼šäº§ç”Ÿç¢ç‰‡
å †æ˜¯åŠ¨æ€åˆ†é…ï¼Œæ ˆæ˜¯åŠ¨æ€å’Œé™æ€åˆ†é…çš„
æ ˆçš„åˆ†é…æ•ˆç‡æ¯”å †é«˜

* xmlè§£æ

domå’Œsax domå¤„ç†è§„æ¨¡è¾ƒå¤§çš„æ–‡æ¡£æ˜¯å¾ˆè€—å†…å­˜å ç”¨èµ„æºæ¯”è¾ƒå¤š

* _objc_msgForwardå‡½æ•°æ˜¯åšä»€ä¹ˆçš„ï¼Œç›´æ¥è°ƒç”¨å®ƒå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

ç”¨æ¥åšæ¶ˆæ¯è½¬å‘ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡å¹¶æ²¡æœ‰å®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°†ä¼šå°è¯•è½¬å‘æ¶ˆæ¯ï¼Œè°ƒç”¨è¿‡ç¨‹ä¼šæ¶‰åŠåˆ°äº”ä¸ªæ–¹æ³•

1. resolveInstanceMethod:
2. forwardingTargetForSelector:
3. methodSignatureForSelector:
4. forwardInvocation:
5. doesNotRecognizeSelector: 

å¦‚æœç›´æ¥è°ƒç”¨ä¼šè·³è¿‡è¿™äº”ä¸ªæ–¹æ³•ã€‚å¦‚æœè½¬å‘çš„å¯¹è±¡æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ã€‚å°†ä¼šç›´æ¥å´©æºƒã€‚å…ˆsendåforward[è¿™é‡Œè¯´çš„å¥½è¯¦ç»†å•Š](http://www.cocoachina.com/ios/20150825/13195.html)

* èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

ä¸èƒ½å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼›èƒ½å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼›åŸå› å¦‚ä¸‹ï¼šå› ä¸ºç¼–è¯‘åçš„ç±»å·²ç»æ³¨å†Œåœ¨ runtime ä¸­ï¼Œç±»ç»“æ„ä½“ä¸­çš„ objc_ivar_list å®ä¾‹å˜é‡çš„é“¾è¡¨ å’Œ instance_size å®ä¾‹å˜é‡çš„å†…å­˜å¤§å°å·²ç»ç¡®å®šï¼ŒåŒæ—¶runtime ä¼šè°ƒç”¨ class_setIvarLayout æˆ– class_setWeakIvarLayout æ¥å¤„ç† strong weak å¼•ç”¨ã€‚æ‰€ä»¥ä¸èƒ½å‘å­˜åœ¨çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼›

è¿è¡Œæ—¶åˆ›å»ºçš„ç±»æ˜¯å¯ä»¥æ·»åŠ å®ä¾‹å˜é‡ï¼Œè°ƒç”¨ class_addIvar å‡½æ•°ã€‚ä½†æ˜¯å¾—åœ¨è°ƒç”¨ objc_allocateClassPair ä¹‹åï¼Œobjc_registerClassPair ä¹‹å‰ï¼ŒåŸå› åŒä¸Šã€‚

* applicationWillEnterForegroundå’ŒapplicationDidBecomeActiveéƒ½ä¼šåœ¨å“ªäº›åœºæ™¯ä¸‹è¢«è°ƒç”¨ï¼Ÿä¸¾ä¾‹è¶Šå¤šè¶Šå¥½ã€‚
* å¦‚ä½•ç»ˆæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œçº¿ç¨‹ï¼Ÿ
* instrument
* å¦‚ä½•è‡ªå·±é«˜æ•ˆå®ç°NSUserDefault?

çœ‹åˆ°è¿™ä¸ªé¢˜ç›®æ˜¯ä¸€ä¸ªç¾¤é‡Œçš„æœ‹å‹å‘çš„ï¼Œæ„Ÿè°¢é‚£ä¸ªå…„å¼Ÿï¼Œçœ‹åˆ°MrPeakå¤§å¤§å‡ºçš„é¢˜ç›®å•Š å¥½å¼€å¿ƒï¼Œè¯•ç€ç­”ï¼Œå„ä½å¤§å¤§è¯·è½»å–·ï¼Œåˆšå¥½ä¸æ€ä¹ˆå¿™ï¼Œå¸¦ç€è€³æœºå¬æ­Œï¼Œç­”äº†ä¸€ä¸ªå°æ—¶ï¼ŒçœŸèˆ’æœå•Šï¼Œçœ‹åˆ°è¿™äº›é¢˜ç›®å¥½å¤šéƒ½ä¸æ€ä¹ˆçŸ¥é“ï¼Œæ¶è¡¥ï¼Œå­¦ä¹ ã€‚

* NSStringå¦‚ä½•è®¡ç®—å­—ç¬¦çš„ä¸ªæ•°ï¼Ÿ

åº”è¯¥æ˜¯ç”¨countElementsçš„å‡½æ•°æ¥ç»Ÿè®¡å­—ç¬¦ä¸²æ‰€åŒ…å«çš„å­—ç¬¦ä¸ªæ•°ï¼ŒæŠŠå‚æ•°ä¸ºè¦ç»Ÿè®¡çš„å­—ç¬¦ä¸²å°±å¥½äº†ã€‚

ä½†æ˜¯éœ€è¦æ³¨æ„ä»¥ä¸‹çš„å‡ ä¸ªç‚¹ï¼š

1. å› ä¸ºä¸åŒçš„Unicodeå­—ç¬¦ï¼ŒåŒæ ·çš„å­—ç¬¦ä¸åŒçš„ç¼–ç éƒ½å¯èƒ½å¯¼è‡´å ç”¨ä¸åŒçš„å†…å­˜ã€‚æ‰€ä»¥æŒ‰æ­£å¸¸æ¥è¯´ï¼Œå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦ä¼šå ç”¨ä¸åŒçš„å†…å­˜ã€‚å› æ­¤ï¼Œåªèƒ½é€šè¿‡éå†å­—ç¬¦ä¸²ä¸­çš„æ¯ä¸ªå­—ç¬¦æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ä½†æ˜¯å½“åœ¨å¤„ç†ä¸€ä¸ªç‰¹åˆ«é•¿çš„å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥é€šè¿‡éå†éå†æ•´ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™æ ·æ—¢å¯ä»¥ç®—å‡ºå­—ç¬¦ä¸²çš„é•¿åº¦äº†ã€‚

2. åŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒcountElementsè®¡ç®—å‡ºæ¥çš„å­—ç¬¦ä¸ªæ•°ä¸NSStringçš„lengthè®¡ç®—å‡ºæ¥çš„é•¿åº¦ä¹Ÿä¸ä¸€å®šæ€»æ˜¯ä¸€æ ·çš„çš„ã€‚å› ä¸ºNSStringçš„é•¿åº¦æ˜¯åŸºUTF-16ç¼–ç çš„ç¼–ç æ¥è®¡ç®—çš„ï¼Œè€Œä¸æ˜¯Unicodeç¼–ç çš„ä¸ªæ•°ã€‚ä½†æ˜¯ï¼Œå¥½åƒåœ¨Swiftä¸­å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²çš„utf16countå±æ€§æ¥æ¥è·å¾—åŸæ¥NSStringçš„lengthå€¼ï¼Œå¿˜è®°äº†ï¼Œå¾ˆä¹…æ²¡ç”¨Swiftäº†ã€‚

* PKIä½“ç³»å½“ä¸­åŠ å¯†å’Œç­¾åæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

è¿™ä¸ªé—®é¢˜æˆ‘æ¥ç­”çš„è¯ï¼Œåº”è¯¥å…ˆè¯´è¯´PKIæ˜¯ä¸€ç§å®‰å…¨æŠ€æœ¯, æ•°å­—ç­¾åå’ŒåŠ å¯†åŸºæœ¬åŸç†æ˜¯ä»€ä¹ˆï¼Œåœ¨è¯´åŒºåˆ«ï¼Œè¯è¯´åŸºæœ¬åŸç†æˆ‘ä¹Ÿä¸è®°å¾—äº†ï¼Œå°±å¤§æ¦‚è®°å¾—ä¸€ä¸ªHUSHå‡½æ•°ä»€ä¹ˆçš„äº†ï¼Œä»–ä»¬çš„è¿‡ç¨‹éƒ½æ˜¯ä½¿ç”¨å…¬å¼€å¯†é’¥ä½“ç³»ï¼Œä½†å®ç°çš„è¿‡ç¨‹æ˜¯ä¸åŒçš„ï¼Œç›¸åï¼Œä½¿ç”¨çš„å¯†é’¥å¯¹ä¹Ÿä¸åŒã€‚

1. æ•°å­—ç­¾åæ˜¯å‘é€æ–¹çš„å¯†é’¥å¯¹ï¼Œå‘é€æ–¹ç”¨è‡ªå·±çš„ç§æœ‰å¯†é’¥è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹ç”¨å‘é€æ–¹çš„å…¬å¼€å¯†é’¥è¿›è¡Œè§£å¯†ï¼Œå¤§è‡´å°±æ˜¯è¿™æ ·å§ï¼Œå®ƒä¸€ä¸ªä¸€å¯¹å¤šçš„å…³ç³»ï¼Œä»»ä½•æ‹¥æœ‰å‘é€æ–¹å…¬å¼€å¯†é’¥çš„äººéƒ½å¯ä»¥éªŒè¯æ•°å­—ç­¾åçš„æ­£ç¡®æ€§ï¼Œè¿˜æœ‰åªé‡‡ç”¨äº†éå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•,èƒ½ä¿è¯å‘é€ä¿¡æ¯çš„å®Œæ•´æ€§ã€èº«ä»½è®¤è¯å’Œä¸å¯å¦è®¤æ€§ã€‚

2. æ•°å­—åŠ å¯†æ˜¯æ¥æ”¶æ–¹çš„å¯†é’¥å¯¹ï¼Œè¿™æ˜¯å¤šå¯¹ä¸€çš„å…³ç³»ï¼Œä»»ä½•çŸ¥é“æ¥æ”¶æ–¹å…¬å¼€å¯†é’¥çš„äººéƒ½å¯ä»¥å‘æ¥æ”¶æ–¹å‘é€åŠ å¯†ä¿¡æ¯ï¼Œåªæœ‰å”¯ä¸€æ‹¥æœ‰æ¥æ”¶æ–¹ç§æœ‰å¯†é’¥çš„äººæ‰èƒ½å¯¹ä¿¡æ¯è§£å¯†,ç”¨çš„å¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•å’Œéå¯¹ç§°å¯†é’¥åŠ å¯†ç®—æ³•ç›¸ç»“åˆçš„æ–¹æ³•ï¼Œå®ƒèƒ½ä¿è¯å‘é€ä¿¡æ¯ä¿å¯†æ€§ã€‚

* å¦‚ä½•è‡ªå·±é«˜æ•ˆå®ç°NSUserDefault?

è¿™ä¸ªï¼ŒçœŸå¿ƒä¸çŸ¥é“ï¼Œpeakå¤§å¤§ã€‚åªçŸ¥é“NSUserDefaultsæ˜¯å®šæ—¶æŠŠç¼“å­˜ä¸­çš„æ•°æ®å†™å…¥ç£ç›˜çš„ï¼Œè€Œä¸æ˜¯å³æ—¶å†™å…¥ï¼Œä¸ºäº†é˜²æ­¢åœ¨å†™å®ŒNSUserDefaultsåç¨‹åºé€€å‡ºå¯¼è‡´çš„æ•°æ®ä¸¢å¤±ï¼Œå¯ä»¥åœ¨å†™å…¥æ•°æ®åä½¿ç”¨synchronizeå¼ºåˆ¶ç«‹å³å°†æ•°æ®å†™å…¥ç£ç›˜ï¼Œç°åœ¨è¦é«˜æ•ˆçš„å®ç°NSUserDefaultsï¼Œä¸ªäººè§è§£å°±æ˜¯ä¸é¢‘ç¹çš„ä½¿ç”¨synchornizeï¼Œè‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œåœ¨å­˜å–æ—¶é€šè¿‡NSDataåšè½½ä½“ã€‚

* è§£é‡Šä¸‹tcpçš„æ…¢å¯åŠ¨ç‰¹æ€§ã€‚

ç°åœ¨å…¬å¸åº”è¯¥éƒ½æ˜¯åœ¨é¿å…æ…¢å¯åŠ¨ï¼Œåšæ€§èƒ½ä¼˜åŒ–å§ï¼Œä¼˜åŒ–åº”è¯¥å¯ä»¥å°½é‡æŠŠå¤§é‡å°æ–‡ä»¶æ”¾åœ¨ä¸€ä¸ªTCPè¿æ¥ä¸­æ’é˜Ÿä¼ è¾“å§ï¼Œæ²¡è¯•éªŒè¿‡ï¼Œè‡ªå·±YYçš„ã€‚

è¿™é—®çš„æ˜¯Tcpæ…¢å¯åŠ¨çš„ç‰¹ç‚¹ï¼Œéš¾é“å°±æ˜¯å®ƒåœ¨æ–°å»ºç«‹çš„è¿æ¥ä¸èƒ½å¤Ÿä¸€å¼€å§‹å°±å‘é€å¤§å°ºå¯¸çš„æ•°æ®åŒ…ï¼Œè€Œåªèƒ½ä»ä¸€ä¸ªå°å°ºå¯¸çš„åŒ…å¼€å§‹å‘é€ï¼Œåœ¨å‘é€å’Œæ•°æ®è¢«å¯¹æ–¹ç¡®è®¤çš„è¿‡ç¨‹ä¸­å»è®¡ç®—å¯¹æ–¹çš„æ¥æ”¶é€Ÿåº¦ï¼Œæ¥é€æ­¥å¢åŠ æ¯æ¬¡å‘é€çš„æ•°æ®é‡ï¼Œä½†æ˜¯è¿™æ ·çš„è¯ æ€§èƒ½å‘¢ï¼Œè¯·ç§‘æ™®ä¸‹ï¼Œè°¢è°¢ã€‚

* å¦‚ä½•ç”¨HTTPå®ç°é•¿è¿æ¥ï¼Ÿ

é¦–å…ˆHTTPæ˜¯æ— çŠ¶æ€çš„ï¼Œè¦ç»´æŒä¸€ä¸ªé•¿è¿æ¥å¯ä»¥ç”¨å¿ƒè·³åŒ…å•Šï¼Œå…¬å¸é¡¹ç›®ç¬¬ä¸€ä¸ªç‰ˆæœ¬å°±æ˜¯è¿™æ ·ç”¨çš„ï¼Œç„¶åå„ç§åŸå› ï¼Œå„ç§å‘µå‘µå‘µï¼Œä¸¢åŒ…ï¼Œæ²¾åŒ…ï¼Œåº”è¯¥å¯ä»¥å¯¹httpè¿æ¥è¿›è¡Œè½®è¯¢ï¼Œä½†æ˜¯httpå®šæ—¶è½®è¯¢ä¼šå­˜åœ¨å»¶è¿Ÿ ç”¨æˆ·ä½“éªŒå°±ä¸å¥½äº† æˆ–è€…ç”¨socketæµæ–¹æ³•ï¼Œç›‘å¬æœåŠ¡å™¨æ¶ˆæ¯

* HTTP2.0é’ˆå¯¹åŒä¸€ä¸ªåŸŸåçš„å¤šä¸ªè¯·æ±‚ï¼Œä¼šå»ºç«‹å¤šå°‘ä¸ªtcpè¿æ¥ï¼Ÿ

ä¸ä¸€å®šçš„ï¼Œä¸€ä¸ªé¡µé¢ç”±htmlã€cssã€jsã€å›¾ç‰‡ç»„æˆï¼Œè¿æ¥æ•°è¦çœ‹å…·ä½“é¡µé¢èµ„æºçš„å¤§å°å’ŒæœåŠ¡å™¨ç«¯çš„é…ç½®ã€‚

* æ•°æ®åº“å»ºè¡¨çš„æ—¶å€™ç´¢å¼•æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

åˆ›å»ºç´¢å¼•å¯ä»¥å¤§å¤§æé«˜ç³»ç»Ÿçš„æ€§èƒ½ï¼ŒåŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼ŒåŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥ï¼Œä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ï¼Œä½†æ˜¯æœ‰äº›åˆ—ä¸åº”è¯¥åˆ›å»ºç´¢å¼•ï¼Œè¿™åˆè¦è€ƒè™‘åˆ°æ€§èƒ½äº†ï¼Œæ‰€ä»¥å…·ä½“æƒ…å†µå…·ä½“åˆ†æäº†ã€‚

* Full Text Searchä¸ºä»€ä¹ˆå¿«ï¼Ÿ

è¿™æˆ‘ä¸æ˜¯åå°ä¸æ˜¯å¾ˆäº†è§£ï¼Œé—®é¢˜ååå°ç³»ç»Ÿå¤šä¸€ç‚¹ç‚¹äº†ï¼Œä½†æ˜¯è‡ªå·±ä¼šå†™ä¸€ç‚¹ç‚¹PHPï¼Œå¥½åƒæ˜¯ç”¨ç©ºé—´æ¥æ¢æ—¶é—´,é€šè¿‡åˆ†è¯å™¨ï¼Œé™ç´¢å¼•çš„è¡¨åˆ†å‰²å•¥çš„ï¼Œä¸æ˜¯å¾ˆæ¸…æ¥šåŸç†å•Šï¼Œçœ‹æ¥è¦ç³»ç»Ÿå­¦ä¸‹åå°è¯­è¨€ã€‚

* iOSä¸‹å¦‚ä½•å®ç°æŒ‡å®šçº¿ç¨‹æ•°ç›®çš„çº¿ç¨‹æ± ï¼Ÿ

è¿™ä¸ªé—®é¢˜é—®çš„å¤ªæ·±äº†å§ï¼Œä¸€èˆ¬å¼€å‘æ ¹æœ¬ç”¨ä¸åˆ°ï¼Œè¿˜å¥½æœ€è¿‘åœ¨çœ‹çº¿ç¨‹å®‰å…¨æ–¹é¢çš„ä¹¦ç±ï¼Œè¦ä¸ç„¶é—®åˆ°çœŸçš„ä¼šæ‡µé€¼ã€‚

1.å¾ªç¯é€šè¿‡pthread_createåˆ›å»ºçº¿ç¨‹ï¼Œåˆ›å»ºs_tfthreadå¯¹è±¡åšä¸ºçº¿ç¨‹å¥ï¼ŒåŠ å…¥çº¿ç¨‹æ•°ç»„,s_tftask_content->methordåˆå§‹åŒ–ä¸ºç©ºå‡½æ•°

2.åˆ›å»ºä»»åŠ¡æ‰§è¡Œå‡½æ•°ï¼Œæ‰§è¡Œå®Œé€šè¿‡taskåˆå§‹åŒ–å‡½æ•°åï¼Œåœ¨æ‰§è¡Œå‡½æ•°ä¸­é€šè¿‡pthread_cond_waitä¿¡å·å°†å½“å‰åˆ›å»ºçš„çº¿ç¨‹æŒ‚èµ·

3.åˆ›å»ºå®Œä¹‹åï¼Œç¨‹åºä¸­å°†ä¼šæœ‰nä¸ªæŒ‚èµ·çŠ¶æ€çš„çº¿ç¨‹ï¼Œå½“éœ€è¦æ‰§è¡Œæ–°çš„taskçš„æ—¶å€™æŸ¥æ‰¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®ä¸åŒçš„taskæ ‡å¿—åœ¨k_threadsä¸­æŸ¥è¯¢å‡ºç©ºé—²çº¿ç¨‹ï¼Œå¹¶åˆ›å»ºæ–°çš„s_tftask_contentåŠ å…¥s_tfthreadçš„ä»»åŠ¡åˆ—è¡¨ï¼Œé€šè¿‡pthread_cond_signalé‡æ–°å”¤é†’è¯¥çº¿ç¨‹ç»§ç»­æ‰§è¡Œä»»åŠ¡

* ä»‹ç»ä¸‹iOSè®¾å¤‡è·å–å”¯ä¸€è®¾å¤‡å·çš„å†å²å˜è¿ã€‚

è¿™ä¸ªæ²¡åšè¿‡å‡ å¹´å¼€å‘çš„çœŸå¿ƒä¸çŸ¥é“ï¼ŒiOSä¸­è·å–è®¾å¤‡å”¯ä¸€æ ‡ç¤ºç¬¦çš„æ–¹æ³•ä¸€ç›´éšç‰ˆæœ¬çš„æ›´æ–°è€Œå˜åŒ–ã€‚iOS 2.0ç‰ˆæœ¬ä»¥åUIDeviceæä¾›ä¸€ä¸ªè·å–è®¾å¤‡å”¯ä¸€æ ‡è¯†ç¬¦çš„æ–¹æ³•uniqueIdentifierï¼Œä½†æ˜¯å¥½åƒæ˜¯iOS 4è¿˜æ˜¯iOS5å°±è¢«è‹¹æœåºŸå¼ƒæ‰äº†ï¼Œç„¶åiOS6æ˜¯ç”¨WiFiçš„macåœ°å€æ¥è·å–çš„ï¼ŒiOS7åå¤§å®¶éƒ½çŸ¥é“äº†ï¼Œä¸»è¦æ˜¯ç”±äºè‹¹æœåˆå‘çˆ¹äº†ï¼Œå°æ€macåœ°å€ï¼Œä½†æ˜¯æ¨èå¤§å®¶ç”¨KeyChainæ¥ä¿å­˜è·å–åˆ°çš„UDIDï¼Œå› ä¸ºAPPåˆ äº†å†è£…å›æ¥ï¼Œä¹Ÿå¯ä»¥ä»KeyChainä¸­è¯»å–å›æ¥ï¼Œå“ˆå“ˆï¼Œå…¬å¸çš„é¡¹ç›®éƒ½æ˜¯æŠŠUDIDå­˜åœ¨KeyChainã€‚

* å‡½æ•°å¼ç¼–ç¨‹å½“ä¸­çš„ first-class functionæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ

è¿™ä¸ªé—®é¢˜å¥½åƒä»¥å‰å°±åœ¨çŸ¥ä¹çœ‹è¿‡ï¼Œå°±æ˜¯ç±»å‹ï¼Œå®šä¹‰äº†ä¸€ä¸ªå¯ä»¥æ“ä½œçš„å–å€¼çš„é›†åˆï¼Œå°±åƒCè¯­è¨€çš„intç±»å‹ä¸€æ ·ï¼Œå¯è¿›è¡ŒåŠ å‡ä¹˜é™¤ç­‰æ“ä½œï¼Œä½†æ˜¯å®ƒçš„è®¾è®¡åˆæœ‰ä¸€ä¸ªæ¨¡å—å¤ç”¨å’Œè®¿å­˜æ§åˆ¶,è¿™æ ·è®¾è®¡çš„åŸå› åº”è¯¥æ˜¯è®©æˆ‘ä»¬æ›´å¥½ç”¨å§ï¼Œæ²¡æœ‰æ·±ç©¶è¿‡è¿™ä¸ªã€‚

* å¦‚ä½•ä½¿ç”¨runtime hookä¸€ä¸ªclassçš„æŸä¸ªæ–¹æ³•ï¼Œåˆå¦‚ä½•hookæŸä¸ªinstanceçš„æ–¹æ³•ï¼Ÿ

åšåˆ°è¿™é‡Œåœ¨ç”µè„‘ç å­—å¿«ä¸‰ååˆ†é’Ÿäº†å•Šï¼Œpeakå¤§å¤§ï¼Œä½ é—®çš„é—®é¢˜éƒ½å¥½éš¾å›ç­”å•Šï¼Œè¦åˆ†å„ç§æƒ…å†µã€‚è¿™é¢˜ä¹Ÿæ˜¯é¦–å…ˆè¦è€ƒè™‘ hookæ˜¯å¦æœ‰å…¬å¼€å¤´æ–‡ä»¶çš„ç±»ï¼Œæœ‰çš„è¯å†™ä¸€ä¸ªUtilityå‡½æ•°ï¼Œå†ä½¿ç”¨categoryï¼Œæ²¡æœ‰çš„è¯å°±å»ºä¸€ä¸ªç±»ä½œä¸ºæ–°å‡½æ•°è½½ä½“ï¼Œç„¶åå…ˆä¸ºè¢«hookçš„ç±»å¢åŠ å‡½æ•°ï¼Œå†æ›¿æ¢ï¼Œæ²¡é”™å°±æ˜¯è¿™ä¸ªæ ·å­ã€‚åé¢å¦‚ä½•hå¦‚ä½•hookæŸä¸ªinstanceçš„æ–¹æ³•ï¼Œåº”è¯¥å¯ä»¥å®šä¹‰ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆå˜é‡ï¼Œhookæ—¶å°†è¦è°ƒç”¨çš„åœ°å€èµ‹ç»™è¿™ä¸ªå˜é‡ï¼Œè°ƒç”¨æ—¶æŠŠè¿™ä¸ªå˜é‡å½“ä½œå‡½æ•°æ¥ç”¨å°±è¡Œäº†ã€‚

* è°ˆä¸‹Objective Céƒ½æœ‰å“ªäº›é”æœºåˆ¶ï¼Œä½ ä¸€èˆ¬ç”¨å“ªä¸ªï¼Ÿ

synchronizedã€NSLOCKã€GCDã€é€’å½’é”ã€åˆ†å¸ƒé”ã€åŒæ­¥é”ï¼ˆè¿™ä¸ªæ˜¯Cè¯­è¨€çš„ï¼‰ï¼Œä¸€èˆ¬ç”¨GCDï¼Œè¿™é‡Œå°±ä¸è¯´äº†ï¼ŒçœŸå¿ƒä¸æƒ³ç å­—äº†ï¼Œpeakå¤§å¤§å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆï¼Œåˆè¦æŠŠå„ç§é”æœºåˆ¶å¯¹æ¯”ï¼Œè¿™æˆ‘ä¼šç–¯ï¼Œæˆ‘è„‘è¢‹è¦æ­»æœºäº†ï¼Œé‡å¯ä¸­â€¦

* èŠä¸‹HTTP postçš„bodyä½“ä½¿ç”¨form-urlencodedå’Œmultipart/form-dataçš„åŒºåˆ«ã€‚

httpå®šä¹‰äº†ä¸æœåŠ¡å™¨äº¤äº’çš„ä¸åŒæ–¹æ³•ï¼Œæœ€åŸºæœ¬çš„æ–¹æ³•æœ‰4ç§ï¼Œåˆ†åˆ«æ˜¯GETï¼ŒPOSTï¼ŒPUTï¼ŒDELETEï¼Œåˆšå¥½å…¬å¸ä¸Šä¸ªé¡¹ç›®éƒ½ç”¨äº†è¿™å››ç§æ–¹å¼çš„è¯·æ±‚ï¼Œæ€ä¹ˆéƒ½æ˜¯è¸©è¿‡å¾—å‘ã€‚

form-urlencodedæ˜¯é»˜è®¤çš„mimeå†…å®¹ç¼–ç ç±»å‹ï¼Œæ˜¯é€šç”¨çš„ï¼Œä½†æ˜¯å®ƒåœ¨ä¼ è¾“æ¯”è¾ƒå¤§çš„äºŒè¿›åˆ¶æˆ–è€…æ–‡æœ¬æ•°æ®æ—¶æ•ˆç‡æä½ã€‚

multipart/form-dataæ˜¯å½“ä¸Šä¼ æ–‡ä»¶æˆ–è€…äºŒè¿›åˆ¶æ•°æ®å’ŒéASCIIæ•°æ®ä½¿ç”¨ã€‚

* è®©ä½ è®¾è®¡ä¸€ç§æœºåˆ¶æ£€æµ‹UIViewControllerçš„å†…å­˜æ³„æ¼ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿ

è¿™ä¸ªé—®é¢˜æ²¡æœ‰è€ƒè™‘è¿‡ï¼Œéƒ½æ˜¯è‡ªå·±å†™å•å…ƒæµ‹è¯•ä»€ä¹ˆçš„æ¥æµ‹è¯•ï¼Œéƒ½æ˜¯äº›åŸºç¡€çš„æµ‹è¯•ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨Instrumentæ¥æµ‹è¯•ä¸€äº›ä¸œè¥¿çš„ã€‚è‡ªå·±è®¾è®¡çš„è¯ï¼Œä¸»è¦è¿˜æ˜¯è¦è€ƒè™‘ä¸€ä¸ªVCçš„ç”Ÿå‘½å‘¨æœŸã€‚

* é€šè¿‡[UIImage imageNamed:]ç”Ÿæˆçš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™è¢«é‡Šæ”¾ï¼Ÿ

åº”è¯¥æ˜¯åˆ°@autoreleasepool ç»“æŸçš„æ—¶å€™æ‰é‡Šæ”¾çš„ï¼Œä½†æ˜¯æˆ‘éƒ½æ˜¯ç”¨è¿™imageWithContentsOfFileæ–¹æ³•åŠ è½½å›¾ç‰‡çš„

* applicationWillEnterForegroundå’ŒapplicationDidBecomeActiveéƒ½ä¼šåœ¨å“ªäº›åœºæ™¯ä¸‹è¢«è°ƒç”¨ï¼Ÿä¸¾ä¾‹è¶Šå¤šè¶Šå¥½ã€‚

æ¨é€ã€åšæ”¯ä»˜çš„æ—¶å€™ï¼Œè·³åˆ°äººå®¶è¿ç”¨ï¼Œåå°æ€è¿›ç¨‹çš„æ—¶å€™ã€åšIMçš„æ—¶å€™ã€ç¬¬ä¸‰æ–¹æˆæƒåˆ†äº«ç™»å½•å›è°ƒæƒ…å†µä¸‹ç­‰ç­‰

* å¦‚ä½•ç»ˆæ­¢æ­£åœ¨è¿è¡Œçš„å·¥ä½œçº¿ç¨‹ï¼Ÿ

åœ¨çº¿ç¨‹ä¸­è°ƒç”¨exitã€pthread_exitã€pthread_killã€pthread_canceéƒ½è¡Œå§

* ç©·ä¸¾iOSä¸‹æ‰€æœ‰çš„æœ¬åœ°æŒä¹…åŒ–æ–¹æ¡ˆã€‚

æ²™ç›’

plistæ–‡ä»¶ï¼ˆå±æ€§åˆ—è¡¨ï¼‰

preferenceï¼ˆåå¥½è®¾ç½®ï¼‰

NSKeyedArchiverï¼ˆå½’æ¡£ï¼‰

SQLite 3

CoreData
>åº”ç”¨é‡Œæœ‰å“ªå‡ ä¸ªæ–‡ä»¶å¤¹ï¼ŒiTunesä¼šä¿å­˜çš„æ˜¯å“ªä¸ªæ–‡ä»¶å¤¹

>Application: 

>Documents: æœ€å¸¸ç”¨çš„ç›®å½•ï¼ŒiTunesåŒæ­¥è¯¥åº”ç”¨æ—¶ä¼šåŒæ­¥æ­¤æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œé€‚åˆå­˜å‚¨é‡è¦æ•°æ®ã€‚

>Library/Caches: iTunesä¸ä¼šåŒæ­¥æ­¤æ–‡ä»¶å¤¹ï¼Œé€‚åˆå­˜å‚¨ä½“ç§¯å¤§ï¼Œä¸éœ€è¦å¤‡ä»½çš„éé‡è¦æ•°æ®ã€‚

>Library/Preferences: iTunesåŒæ­¥è¯¥åº”ç”¨æ—¶ä¼šåŒæ­¥æ­¤æ–‡ä»¶å¤¹ä¸­çš„å†…å®¹ï¼Œé€šå¸¸ä¿å­˜åº”ç”¨çš„è®¾ç½®ä¿¡æ¯ã€‚

>tmp:

* å¦‚æœå…¬å¸å¼ºåˆ¶996ï¼Œä½ æœ‰ä»€ä¹ˆå¿ƒé‡Œè¯è¦å¯¹è€æ¿è¯´å—ï¼Ÿ

æ²¡ä»€ä¹ˆè¯ï¼Œä¹ æƒ¯äº†ï¼Œä¸»è¦æƒ³è¦å¯¹äº§å“ç»ç†è¯´ä½ çš„éœ€æ±‚èƒ½ä¸èƒ½æƒ³å¥½åœ¨åšï¼Œä¸è¦çæï¼Œè°¢è°¢

* å¦‚ä½•åº”å¯¹APPç‰ˆæœ¬å‡çº§ï¼Œæ•°æ®ç»“æ„éšä¹‹å˜åŒ–?

è‡ªå·±æ¥è§¦çš„Sqliteç›¸å¯¹å¤šä¸€äº›ï¼Œé€šå¸¸çš„ä½œæ³•æ˜¯é‡å‘½åæ—§ç‰ˆæ•°æ®åº“æ–‡ä»¶->åˆ›å»ºæ–°ç‰ˆæœ¬è¡¨æ ¼->å¯¼å…¥æ—§ç‰ˆæœ¬æ•°æ®->åˆ é™¤æ—§ç‰ˆæœ¬è¡¨
è·¨ç‰ˆæœ¬å‡çº§çš„é—®é¢˜ï¼Œæ•°æ®åº“æ›´æ–°çš„ç›¸å…³æ“ä½œä¸åšåˆå¹¶ï¼Œä¾æ¬¡è¿­ä»£æ›´æ–°
Core dataæ¥è§¦ä¸å¤šï¼Œå¤§éƒ¨åˆ†æ”¹åŠ¨éƒ½åœ¨è½»é‡åŒ–è¿ç§»æ”¯æŒèŒƒå›´å†…ï¼Œå¤æ‚çš„éœ€è¦é‡å†™æŒ‡å®šæ˜ å°„å…³ç³»

* ä½¿ç”¨drawRectæœ‰ä»€ä¹ˆå½±å“ï¼Ÿï¼ˆè¿™ä¸ªå¯æ·±å¯æµ…ï¼Œä½ è‡³å°‘å¾—ç”¨è¿‡ã€‚ã€‚ï¼‰

drawRectæ–¹æ³•ä¾èµ–Core Graphicsæ¡†æ¶æ¥è¿›è¡Œè‡ªå®šä¹‰çš„ç»˜åˆ¶ï¼Œä½†è¿™ç§æ–¹æ³•ä¸»è¦çš„ç¼ºç‚¹å°±æ˜¯å®ƒå¤„ç†touchäº‹ä»¶çš„æ–¹å¼ï¼šæ¯æ¬¡æŒ‰é’®è¢«ç‚¹å‡»åï¼Œéƒ½ä¼šç”¨setNeddsDisplayè¿›è¡Œå¼ºåˆ¶é‡ç»˜ï¼›è€Œä¸”ä¸æ­¢ä¸€æ¬¡ï¼Œæ¯æ¬¡å•ç‚¹äº‹ä»¶è§¦å‘ä¸¤æ¬¡æ‰§è¡Œã€‚è¿™æ ·çš„è¯ä»æ€§èƒ½çš„è§’åº¦æ¥è¯´ï¼Œå¯¹CPUå’Œå†…å­˜æ¥è¯´éƒ½æ˜¯æ¬ ä½³çš„ã€‚ç‰¹åˆ«æ˜¯å¦‚æœåœ¨æˆ‘ä»¬çš„ç•Œé¢ä¸Šæœ‰å¤šä¸ªè¿™æ ·çš„UIButtonå®ä¾‹ã€‚

è¿™ä¸ªæ–¹æ³•çš„ä¸»è¦ä½œç”¨æ˜¯æ ¹æ®ä¼ å…¥çš„ rect æ¥ç»˜åˆ¶å›¾åƒ å‚è§æ–‡æ¡£. è¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°æ²¡æœ‰åšä»»ä½•äº‹æƒ…, æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ä½¿ç”¨ Core Graphics å’Œ UIKit æ¥ç»˜åˆ¶è§†å›¾çš„å†…å®¹.

è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨æœºåˆ¶ä¹Ÿæ˜¯éå¸¸ç‰¹åˆ«. å½“ä½ è°ƒç”¨ setNeedsDisplay æ–¹æ³•æ—¶, UIKit å°†ä¼šæŠŠå½“å‰å›¾å±‚æ ‡è®°ä¸º dirty, ä½†è¿˜æ˜¯ä¼šæ˜¾ç¤ºåŸæ¥çš„å†…å®¹, ç›´åˆ°ä¸‹ä¸€æ¬¡çš„è§†å›¾æ¸²æŸ“å‘¨æœŸ, æ‰ä¼šä¸ºæ ‡è®°ä¸º dirty çš„å›¾å±‚é‡æ–°å»ºç«‹ Core Graphics ä¸Šä¸‹æ–‡, ç„¶åå°†å†…å­˜ä¸­çš„æ•°æ®æ¢å¤å‡ºæ¥, å†ä½¿ç”¨ CGContextRef è¿›è¡Œç»˜åˆ¶.

ç›¸å…³å‚è€ƒ:[UIViewçš„layoutSubviewså’ŒdrawRectæ–¹æ³•ä½•æ—¶è°ƒç”¨](http://xyxdasnjss.iteye.com/blog/1827954)

* ä½¿ç”¨atomicä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ

ä¸æ˜¯ï¼Œatomicçš„æœ¬æ„æ˜¯æŒ‡å±æ€§çš„å­˜å–æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ˆthread safe)ï¼Œå¹¶ä¸ä¿è¯æ•´ä¸ªå¯¹è±¡æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚æ¯”å¦‚ï¼Œå£°æ˜ä¸€ä¸ªNSMutableArrayçš„åŸå­å±æ€§stuffï¼Œæ­¤æ—¶self.stuff å’Œself.stuff = othersulféƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œä½¿ç”¨[self.stuff objectAtIndex:index]å°±ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦ç”¨é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨æ€§ã€‚

[çŸ¥ä¹é¢è¯•é¢˜ç­”æ¡ˆ1](http://www.jianshu.com/p/262c1f8b7461)[çŸ¥ä¹é¢è¯•é¢˜ç­”æ¡ˆ2](http://blog.csdn.net/hanangellove/article/details/45033453)

Follow your heart, but take your brain with you.


###Categories
Categories can be used to declare either instance methods or class methods but are not usually suitable for declaring additional properties. It's valid syntax to include a property declaration in a category interface, but it's not possible to declare an additional instance variable in a category. This means the compiler won't synthesize any instance variable, nor will it synthesize any property accessor methods. You can write your own accessor methods in the implementation, but you won't be able to track for that property unless it's already stored by the original class.

The only way to add a additional property-backed by a new instance variable-to an existing class is to use a class extension, as decribed in [Class Extensions Extend the Internal Implementation](https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/CustomizingExistingClasses/CustomizingExistingClasses.html#//apple_ref/doc/uid/TP40011210-CH6-SW3)

###Use Class Extensions to Hide Private Information



#Write it on your heart that every day is the best day in the year

#2018.08.21
#new interview test

1. è¯´ä¸€ä¸‹OCçš„åå°„æœºåˆ¶
2. blockçš„å®è´¨æ˜¯ä»€ä¹ˆï¼Ÿæœ‰å‡ ç§blockï¼Ÿåˆ†åˆ«æ˜¯æ€æ ·äº§ç”Ÿçš„ï¼Ÿ
3. __blockä¿®é¥°çš„å˜é‡ä¸ºä»€ä¹ˆèƒ½åœ¨blocké‡Œé¢æ”¹å˜å…¶å€¼
4. è¯´ä¸€ä¸‹çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡
5. ä½ ä»¬appçš„å´©æºƒç‡æ˜¯å¤šå°‘ï¼Ÿ
6. è¯´ä¸€ä¸‹hashç®—æ³•
7. NSDicitionaryçš„å®ç°åŸç†æ˜¯ä»€ä¹ˆ
8. ä½ ä»¬çš„appæ˜¯å¦‚ä½•å¤„ç†æœ¬åœ°æ•°æ®å®‰å…¨çš„(æ¯”å¦‚ç”¨æˆ·åå’Œå¯†ç )
9. é‡åˆ°è¿‡BAD_ACCESSçš„é”™è¯¯å—ï¼Ÿä½ æ˜¯æ€æ ·è°ƒè¯•çš„
10. ä»€ä¹ˆäº‹æŒ‡é’ˆå¸¸é‡å’Œå¸¸é‡æŒ‡é’ˆ
11. ä¸å€Ÿç”¨ç¬¬ä¸‰ä¸ªå˜é‡ï¼Œå¦‚ä½•äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ï¼Ÿè¦æ±‚æ‰‹åŠ¨å†™å‡ºäº¤æ¢çš„è¿‡ç¨‹ã€‚
12. å¦‚ä½ å»è®¾è®¡ä¸€ä¸ªé€šçŸ¥ä¸­å¿ƒï¼Œä½ ä¼šæ€æ ·è®¾è®¡ï¼Ÿ
13. å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ–¹æ¡ˆå»åº”å¯¹åç«¯é¢‘ç¹æ›´æ”¹çš„å­—æ®µæ¥å£ï¼Ÿ
14. KVO KVCçš„åŸç†
15. ç”¨é€’å½’ç®—æ³•æ±‚1åˆ°nçš„å’Œ
16. categoryä¸ºä»€ä¹ˆä¸èƒ½æ·»åŠ å±æ€§
17. è¯´ä¸€ä¸‹runloopå’Œçº¿ç¨‹çš„å…³ç³»
18. è¯´ä¸€ä¸‹autoreleasePoolçš„å®ç°åŸç†
19. è¯´ä¸€ä¸‹ç®€å•å·¥å‚æ¨¡å¼ï¼Œå·¥å‚æ¨¡å¼ä»¥åŠæŠ½è±¡å·¥å‚æ¨¡å¼
20. å¦‚ä½•è®¾è®¡ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“
21. è¯´ä¸€ä¸‹å¤šçº¿ç¨‹ä½ å¹³å¸¸æ˜¯æ€ä¹ˆç”¨çš„
22. è¯´ä¸€ä¸‹UITableViewCellçš„å¡é¡¿ä½ æ˜¯æ€ä¹ˆä¼˜åŒ–çš„
23. çœ‹è¿‡å“ªäº›ä¸‰æ–¹åº“ï¼Ÿè¯´ä¸€ä¸‹å®ç°çš„åŸç†ä»¥åŠå¥½åœ¨å“ªé‡Œ
24. è¯´ä¸€ä¸‹HTTPåè®®ä»¥åŠç»å¸¸ä½¿ç”¨çš„codeç çš„å«ä¹‰
25. è®¾è®¡ä¸€å¥—ç¼“å­˜ç­–ç•¥
26. è®¾è®¡ä¸€ä¸ªæ£€æµ‹ä¸»çº¿ç¨‹å’Œå¡é¡¿çš„æ–¹æ¡ˆ
27. è¯´ä¸€ä¸‹runtimeï¼Œå·¥ä½œæ˜¯å¦‚ä½•ä½¿ç”¨çš„çœ‹è¿‡runtimeæºç å—
28. è¯´å‡ ä¸ªä½ åœ¨å·¥ä½œä¸­ä½¿ç”¨åˆ°çš„çº¿ç¨‹å®‰å…¨çš„ä¾‹å­ã€‚
29. ç”¨è¿‡å“ªäº›é”ï¼Ÿå“ªäº›é”çš„æ€§èƒ½æ¯”è¾ƒé«˜
30. è¯´ä¸€ä¸‹httpå’Œhttpsçš„è¯·æ±‚è¿‡ç¨‹
31. è¯´ä¸€ä¸‹tcpå’Œudp
32. è¯´ä¸€ä¸‹é™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ«
33. loadå’Œinitializeæ–¹æ³•åˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨
34. NSNotificationCenteræ˜¯åœ¨å“ªä¸ªçº¿ç¨‹å‘é€çš„é€šçŸ¥
35. ç”¨è¿‡swiftå—ï¼Ÿ
36. è¯´ä¸€ä¸‹ä½ å¯¹æ¶æ„çš„ç†è§£
37. ä¸ºä»€ä¹ˆä¸€å®šè¦åœ¨ä¸»çº¿ç¨‹é‡Œé¢æ›´æ–°UI

* ##1. è¯´ä¸‹OCçš„åå°„æœºåˆ¶

[viewController class];
NSStringFromSelector
NSSelectorFromString
NSStringFromClass
NSClassFromString
NSStringFromProtocol
NSProtocolFromString
isKindOfClass
isMemberOfClass
conformsToProtocol
respondsToSelector

* ##2.blockçš„å®è´¨æ˜¯ä»€ä¹ˆï¼Œæœ‰å‡ ç§blockï¼Œåˆ†åˆ«æ˜¯æ€æ ·äº§ç”Ÿçš„
* ##3.__blockä¿®é¥°çš„å˜é‡ä¸ºä»€ä¹ˆèƒ½åœ¨blocké‡Œé¢æ”¹å˜å…¶å€¼
* ##4.è¯´ä¸€ä¸‹çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡
* ##5.ä½ ä»¬çš„appå´©æºƒç‡æ˜¯å¤šå°‘
* ##6.è¯´ä¸€ä¸‹hashç®—æ³•
* ##7.NSDictionaryçš„å®ç°åŸç†
* ##8.ä½ ä»¬çš„appæ˜¯å¦‚ä½•å¤„ç†æœ¬åœ°æ•°æ®å®‰å…¨çš„(æ¯”å¦‚ç”¨æˆ·åå’Œå¯†ç )
* ##9.é‡åˆ°è¿‡BAD_ACCESSçš„é”™è¯¯å—ï¼Œä½ æ˜¯æ€æ ·è§£å†³çš„
* ##10.ä»€ä¹ˆæ˜¯æŒ‡é’ˆå¸¸é‡å’Œå¸¸é‡æŒ‡é’ˆ
* ##11.ä¸ä½¿ç”¨ç¬¬ä¸‰ä¸ªå˜é‡ï¼Œå¦‚ä½•äº¤æ¢ä¸¤ä¸ªå˜é‡çš„å€¼ï¼Œ
* ##12.å¦‚æœè®¾è®¡ä¸€ä¸ªé€šçŸ¥ä¸­å¿ƒä½ ä¼šæ€æ ·è®¾è®¡
* ##13.å¦‚ä½•è®¾è®¡ä¸€ä¸ªæ–¹æ¡ˆå»åº”å¯¹åç«¯é¢‘ç¹æ›´æ”¹çš„å­—æ®µæ¥å£
* ##14.KVOå’ŒKVCçš„åŸç†
* ##15.ç”¨é€’å½’ç®—æ³•æ±‚1åˆ°nçš„å’Œ
* ##16.categoryä¸ºä»€ä¹ˆä¸èƒ½æ·»åŠ å±æ€§
* ##17.è¯´ä¸€ä¸‹runloopä¸ªçº¿ç¨‹çš„å…³ç³»
* ##18.è¯´ä¸€ä¸‹autoreleasepoolçš„å®ç°åŸç†
* ##19.è¯´ä¸€ä¸‹ç®€å•å·¥ç¨‹æ¨¡å¼ã€å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼
* ##20.å¦‚ä½•è®¾è®¡ä¸€ä¸ªç½‘ç»œè¯·æ±‚åº“
* ##21.è¯´ä¸€ä¸‹å¤šçº¿ç¨‹ä½ å¹³å¸¸æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ
* ##22.è¯´ä¸€ä¸‹UITableViewCellçš„å¡é¡¿ä½ æ˜¯æ€ä¹ˆä¼˜åŒ–çš„ï¼Ÿ
* ##23.çœ‹è¿‡å“ªäº›ä¸‰æ–¹åº“ï¼Ÿè¯´ä¸€ä¸‹å®ç°çš„åŸç†ä»¥åŠå¥½åœ¨å“ªé‡Œï¼Ÿ
* ##24.è¯´ä¸‹httpåè®®ç»å¸¸ä½¿ç”¨codeç çš„å«ä¹‰
* ##25.è®¾è®¡ä¸€å¥—ç¼“å­˜ç­–ç•¥
* ##26.è®¾è®¡ä¸€ä¸ªæ£€æµ‹ä¸»çº¿ç¨‹å¡é¡¿çš„æ–¹æ¡ˆ
* ##27.è¯´ä¸€ä¸‹runtimeï¼Œå·¥ä½œæ˜¯å¦‚ä½•ä½¿ç”¨çš„ï¼Œçœ‹è¿‡æºç å—
* ##28.è¯´å‡ ä¸ªä½ åœ¨å·¥ä½œä¸­ä½¿ç”¨åˆ°çš„çº¿ç¨‹å®‰å…¨çš„ä¾‹å­
* ##29.ç”¨è¿‡å“ªäº›é”ï¼Ÿå“ªäº›é”çš„æ€§èƒ½æ¯”è¾ƒé«˜?
* ##30.è¯´ä¸€ä¸‹httpå’Œhttpsçš„è¯·æ±‚è¿‡ç¨‹
* ##31.è¯´ä¸€ä¸‹tcpå’Œudp
* ##32.è¯´ä¸€ä¸‹é™æ€åº“å’ŒåŠ¨æ€åº“çš„åŒºåˆ«
* ##33.loadå’Œinitializeåˆ†åˆ«åœ¨ä»€ä¹ˆæ—¶å€™è°ƒç”¨
* ##34.NSNotificationCenteræ˜¯åœ¨å“ªä¸ªçº¿ç¨‹å‘é€çš„é€šçŸ¥
* ##35.ç”¨è¿‡swiftå—ï¼Ÿ
* ##36.è¯´ä¸€ä¸‹ä½ å¯¹æ¶æ„çš„ç†è§£
* ##37.ä¸ºä»€ä¹ˆä¸€å®šè¦åœ¨ä¸»çº¿ç¨‹ä¸­æ›´æ–°UI

ç¨‹åºä¸€å¼€å§‹å°±è¿›å…¥äº†ä¸»çº¿ç¨‹

#new interview test 2

1. é£æ ¼å°±é”™é¢˜
2. ä¼˜åŒ–éƒ¨åˆ†
3. ç¡¬ä¼¤éƒ¨åˆ†
4. ä»€ä¹ˆæƒ…å†µä½¿ç”¨weakå…³é”®å­—ç›¸æ¯”assignæœ‰ä»€ä¹ˆä¸åŒ
5. æ€ä¹ˆç”¨copyå…³é”®å­—
6. è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜:@property (copy) NSMutableArray * array;
7. å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨copyä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦copyå…³é”®å­—çš„setterï¼Ÿ
8. @propertyçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setteræ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„
9. @protocolå’Œcategoryä¸­å¦‚ä½•ä½¿ç”¨@property
10. runtimeå¦‚ä½•å®ç°weakå±æ€§
11. @propertyä¸­æœ‰å“ªäº›å±æ€§å…³é”®è¯
12. weakå±æ€§éœ€è¦åœ¨deallocä¸­ç½®ä¸ºnilä¹ˆï¼Ÿ
13. @synthesizeå’Œ@dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ
14. ARCä¸‹ï¼Œä¸æ˜¾ç¤ºæŒ‡å®šä»»ä½•å±æ€§å…³é”®è¯æ—¶ï¼Œé»˜è®¤çš„å…³é”®è¯éƒ½æœ‰å“ªäº›ï¼Ÿ
15. ç”¨@propertyå£°æ˜çš„NSString(æˆ–NSSArrayï¼ŒNSDictionary)ç»å¸¸ä½¿ç”¨copyå…³é”®å­—ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¦‚æœæ”¹ç”¨strongå…³é”®è¯ï¼Œå¯èƒ½é€ æˆä»€ä¹ˆé—®é¢˜
16. å¯¹éé›†åˆç±»çš„å¯¹è±¡çš„copyæ“ä½œ
17. é›†åˆç±»å¯¹è±¡çš„copyä¸mutablecopy
18. @synthesizeåˆæˆå®ä¾‹å˜é‡çš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼ŸåŠ å…¥propertyåä¸ºfooï¼Œå­˜åœ¨ä¸€ä¸ªåä¸º_fooçš„å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆè¿˜ä¼šè‡ªåŠ¨åˆæˆæ–°å˜é‡å—ï¼Ÿ
19. åœ¨æœ‰äº†è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡ä¹‹åï¼Œ@synthesizeè¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯
20. objcä¸­å‘ä¸€ä¸ªnilå¯¹è±¡å‘é€æ¶ˆæ¯å°†ä¼šå‘ç”Ÿä»€ä¹ˆ
21. objcä¸­å‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯[obj foo]å’Œobjc_msgSend()å‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»
22. ä»€ä¹ˆä¼šè°ƒç”¨unrecognized selectorçš„å¼‚å¸¸
23. ä¸€ä¸ªobjcå¯¹è±¡å¦‚ä½•è¿›è¡Œå†…å­˜å¸ƒå±€(è€ƒè™‘æœ‰çˆ¶ç±»çš„æƒ…å†µ)
24. ä¸€ä¸ªobjcå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨
25. ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ
		
		@implementation Son: Father
		- (id)init {
			self = [super init];
			if (self) {
				NSLog(@"%@", NSStringFromClass([self class]));		NSLog(@"%@", NSStringFromClass([super class]));
			}
		}
		

* ##1.é£æ ¼çº é”™é¢˜
	
		typedef enum {
			UserSex_Man,
			UserSex_Woman,
		}UserSex;
		
		@interface UserModel: NSObject
		
		@property(nonatomic, strong) NSString * name;
		@property(assign, nonatomic) int age;
		@property(nonatomic, assign) UserSex	sex;
		
		- (id)initUserModelWithUserName:(NSString *)name WithAge:(int)age;
		- (void)doLogin;
		
		@end

ä¿®æ”¹å®Œæˆåçš„ä»£ç :

	typedef NS_ENUM(NSUInteger, UCNSex) {
		UCNSexMale,
		UCNSexFemale,
	}
	
	@interface UCNUsermodel: NSObject 
	
	@property(nonatomic, copy) NSString * name;
	@property(nonatomic, assign) int age;
	@property(nonatomic, assign) UCNUserSex sex;
	
	- (instancetype)initWithName:(NSString *)name age:(int)age sex:(UCNUserSex)sex;
	
	+ (instancetype)userWithName:(NSString *)name age:(int)age sex:(UCNUserSex)sex;
	
	@end

ä¼˜åŒ–éƒ¨åˆ† 
1. enumå»ºè®®ç”¨NS_ENUMå’ŒNS_OPTIONS
2. å¤§å‹é¡¹ç›®é¿å…å†²çªåŠ ä¸Šå‰ç¼€
3. doLogInä¸åº”å†™åœ¨æ¨¡å‹ç±»é‡Œ
4. doLogInå‘½åæ–¹æ³•ä¸è§„èŒƒloginæ˜¯åè¯LogInæ˜¯åŠ¨è¯
5. ä¸è¦ç”¨è¿ç»­å¤šä¸ªwith
6. NSStringç”¨copy(éç»å¯¹ä½†æ˜¯ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯è¿™æ ·çš„)
7. åˆå§‹åŒ–ä¹Ÿè¦åŠ ä¸Šsex
8. assignå’Œnonatomicæ¢ä½ç½®

ç¡¬ä¼¤éƒ¨åˆ†
1. -å’Œ(void)ä¹‹é—´åº”è¯¥æœ‰ä¸€ä¸ªç©ºæ ¼
2. enumä¸­é©¼å³°å‘½åæ³•å’Œä¸‹åˆ’çº¿å‘½åæ³•æ··ç”¨
3. enumå·¦æ‹¬å·å‰åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œæˆ–è€…å°†å·¦æ‹¬å·æ¢åˆ°ä¸‹ä¸€è¡Œ
4. enumå³æ‹¬å·ååŠ ä¸€ä¸ªç©ºæ ¼
5. UserModel :NSObjectå³è¾¹å°‘ä¸€ä¸ªç©ºæ ¼
6. etc

* ##2.ä»€ä¹ˆæƒ…å†µä½¿ç”¨weakå…³é”®å­—ï¼Œç›¸æ¯”assignæœ‰ä»€ä¹ˆä¸åŒ

1. åœ¨arcä¸­ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨
2. xib storyboardä¸­
3. weakè¡¨ç¤ºéæ‹¥æœ‰å…³ç³»æ—¢ä¸ä¿ç•™æ–°å€¼ä¹Ÿä¸é‡Šæ”¾æ—§å€¼ã€è‡ªåŠ¨ç½®ç©º
4. assignç”¨äºéOCå¯¹è±¡ weakå¿…é¡»ç”¨äºOCå¯¹è±¡

* ##3.æ€ä¹ˆç”¨copyå…³é”®è¯

1. NSString NSArray NSDictionary å› ä¸ºä»–ä»¬æœ‰å¯¹åº”å¯å˜ç±»å‹
2. block

blockä½¿ç”¨copyæ˜¯MRCé—ç•™ä¸‹æ¥çš„é—®é¢˜ å±€éƒ¨å˜é‡blockæ˜¯æ”¾åœ¨æ ˆåŒºçš„copyå¯ä»¥æŠŠå®ƒæ”¾åˆ°å †åŒºã€‚åœ¨ARCä¸­ä¸å†™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ä½†å†™ä¸Šä¼šæ—¶åˆ»æé†’æˆ‘ä»¬ç¼–è¯‘å™¨è‡ªåŠ¨å¯¹blockè¿›è¡Œäº†copyæ“ä½œã€‚æ¯”å¦‚ä¸‹é¢çš„æ“ä½œä¸å†™ä¹Ÿè¡Œã€‚

	@property(nonatomic, copy) NSString * name;
	
	- (instancetype)initWithName:(NSString *)name {
		self = [super init];
		if (!self) {
			return nil;
		}
		_name = [name copy];
		return self;
	}

* ##4.è¿™ä¸ªå†™æ³•ä¼šå‡ºä»€ä¹ˆé—®é¢˜ @property (copy)NSMutableArray * array;

1. æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ã€æ•°ç»„å†…çš„å…ƒç´ ä¼šå› æ‰¾ä¸åˆ°æ–¹æ³•è€Œå´©æºƒï¼Œå› ä¸ºcopyå°±æ˜¯å¤åˆ¶ä¸€ä¸ªä¸å¯å˜NSArrayçš„å¯¹è±¡
2. ä½¿ç”¨äº†atomicä¼šä¸¥é‡å½±å“æ€§èƒ½é—®é¢˜ã€‚

* ##5.å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨copyä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦copyå…³é”®å­—çš„setterï¼Ÿ

1. éœ€è¦å£°æ˜è¯¥ç±»éµä»NSCopyingåè®®
2. å®ç°NSCopyingåè®®ï¼Œè¯¥åè®®åªæœ‰ä¸€ä¸ªæ–¹æ³•:

		- (id)copyWithZone:(NSZone *)zone;

å¦‚ä½•é‡å†™å¸¦copyå…³é”®å­—çš„setter

	- (void)setName:(NSString *)name {
		_name = [name copy];
	}

* ##6.@propertyçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿivarã€getterã€setteræ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„

@proterty = ivar + getter + setter

propertyåœ¨runtimeä¸­æ—¶obj\_property\_tå®šä¹‰å¦‚ä¸‹:

	typedef struct objc_property * obj_property_t;

è€Œobjc_propertyæ˜¯ä¸€ä¸ªç»“æ„å¤´ï¼ŒåŒ…æ‹¬nameå’Œattributesï¼Œå®šä¹‰å¦‚ä¸‹:

	struct property_t {
		const char *name;
		const char *attributes;
	}

è€Œattributesæœ¬è´¨ä¸Šæ˜¯objc\_property\_attribute\_t,å®šä¹‰äº†propertyçš„ä¸€äº›å±æ€§ï¼Œå®šä¹‰å¦‚ä¸‹:

///Defines property attribute
typdedef struct {
	const char * name;		/**<The name of the attribute*/
	const char * value;		/**<The value of the attribute (usually empty)*/
} objc_property_attribute_t;

è€Œattributesçš„å…·ä½“å†…å®¹æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¶å®ï¼ŒåŒ…æ‹¬:ç±»å‹ã€åŸå­æ€§ï¼Œå†…å­˜è¯­ä¹‰å’Œå¯¹åº”çš„å®ä¾‹å˜é‡ã€‚

ä¾‹å¦‚:æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªstringçš„property

	@property(nonatomic, copy)NSString * string;
,é€šè¿‡

	property_getAttributes(property)
è·å–åˆ°attributeså¹¶æ‰“å°å‡ºæ¥ä¹‹åçš„ç»“æœä¸º

	T@"NSString",C,N,V_string
å…¶ä¸­Tå°±ä»£è¡¨ç±»å‹ï¼Œå¯å‚é˜…[Type Encoding](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100-SW1)ï¼ŒCä»£è¡¨copyï¼ŒNä»£è¡¨nonatomicï¼ŒVä»£è¡¨å®ä¾‹å˜é‡ã€‚

ivarã€getterã€setteræ˜¯å¦‚ä½•ç”Ÿæˆå¹¶æ·»åŠ åˆ°è¿™ä¸ªç±»ä¸­çš„ï¼Ÿ
>è‡ªåŠ¨åˆæˆ(autosynthesis)

å®Œæˆå±æ€§å®šä¹‰åï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç¼–å†™è®¿é—®è¿™äº›å±æ€§æ‰€éœ€çš„æ–¹æ³•ï¼Œæ­¤è¿‡ç¨‹å«åš"è‡ªåŠ¨åˆæˆ",è¿™ä¸ªè¿‡ç¨‹æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸæ‰§è¡Œï¼Œæ‰€ä»¥çœ‹ä¸åˆ°ä»»ä½•æºç ã€‚é™¤äº†è‡ªåŠ¨ç”Ÿæˆæ–¹æ³•ä»£ç getterã€setterä¹‹å¤–ï¼Œç¼–è¯‘å™¨è¿˜è¦è‡ªåŠ¨å‘ç±»ä¸­æ·»åŠ é€‚å½“ç±»å‹çš„å®ä¾‹å˜é‡ã€‚æˆ‘çš„ç†è§£æ˜¯propertyåšäº†ä¸Šè¿°æºç åšçš„äº‹è¿™æ—¶å€™å¹¶æ²¡æœ‰å°†å®ä¾‹å˜é‡åŠ å…¥åˆ°ç±»ä¸­ï¼Œéšååœ¨ç¼–è¯‘æœŸç”±ç¼–è¯‘å™¨åŠ å…¥äº†ç±»ä¸­ã€‚

æˆ‘ä¸ºäº†ææ¸…æ¥šå±æ€§æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œæ›¾ä»Šåç¼–è¯‘è¿‡ç›¸å…³çš„ä»£ç ï¼Œä»–å¤§è‡´ç”Ÿæˆäº†äº”ä¸ªä¸œè¥¿
1. OBJC_IVAR_$ç±»å$å±æ€§åç§°:è¯¥å±æ€§çš„åç§»é‡(offset)ï¼Œè¿™ä¸ªåç§»é‡æ˜¯ç¡¬ç¼–ç (hardcode)è¡¨ç¤ºè¯¥å˜é‡è·ç¦»å­˜æ”¾å¯¹è±¡çš„å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€æœ‰å¤šè¿œã€‚
2. setterå’Œgetteræ–¹æ³•å¯¹åº”çš„å®ç°å‡½æ•°
3. ivar_listï¼šæˆå‘˜å˜é‡åˆ—è¡¨
4. method_listï¼š æ–¹æ³•åˆ—è¡¨
5. prop_list: å±æ€§åˆ—è¡¨

ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ¯æ¬¡å¢åŠ ä¸€ä¸ªå±æ€§ï¼Œç³»ç»Ÿéƒ½ä¼šåœ¨ivar_listä¸­æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡çš„æè¿°ï¼Œåœ¨method_listä¸­æ·»åŠ setterä¸getteræ–¹æ³•çš„æè¿°ï¼Œåœ¨å±æ€§åˆ—è¡¨ä¸­å¢åŠ ä¸€ä¸ªå±æ€§çš„æè¿°ï¼Œç„¶åè®¡ç®—è¯¥å±æ€§åœ¨å¯¹è±¡ä¸­çš„åç§»é‡ï¼Œç„¶åç»™å‡ºsetterä¸getteræ–¹æ³•å¯¹åº”çš„å®ç°ï¼Œåœ¨setteræ–¹æ³•ä¸­åç§»é‡çš„ä½ç½®å¼€å§‹èµ‹å€¼ï¼Œåœ¨getteræ–¹æ³•ä¸­ä»åç§»é‡å¼€å§‹å–å€¼ï¼Œä¸ºäº†èƒ½å¤Ÿè¯»å–æ­£ç¡®å­—èŠ‚æ•°ï¼Œç³»ç»Ÿå¯¹è±¡åç§»é‡çš„æŒ‡é’ˆç±»å‹è¿›è¡Œäº†ç±»å‹å¼ºè½¬ã€‚

* ##7.@protocolå’Œcategoryä¸­å¦‚ä½•ä½¿ç”¨@property

åœ¨protocolå’Œcategoryä¸­åªä¼šç”Ÿæˆsetterå’Œgetteræ–¹æ³•å£°æ˜ï¼Œå¦‚æœæˆ‘ä»¬åœ¨categoryä¸­éœ€è¦å¢åŠ å±æ€§çš„å®ç°ï¼Œéœ€è¦å€ŸåŠ©è¿è¡Œæ—¶çš„ä¸¤ä¸ªå‡½æ•°:objc_setAssociatedObjectå’Œobjc_getAssociatedObject

* ##8.runtimeå¦‚ä½•å®ç°weakå±æ€§

runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ
>runtimeå¯¹æ³¨å†Œçš„ç±»ï¼Œä¼šè¿›è¡Œå¸ƒå±€ï¼Œå¯¹äºweakå¯¹è±¡ä¼šæ”¾å…¥ä¸€ä¸ªhashè¡¨ä¸­ã€‚ç”¨weakæŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€ä½œä¸ºkeyï¼Œå½“æ­¤å¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ä¼šdeallocï¼ŒåŠ å…¥weakæŒ‡å‘çš„å¯¹è±¡å†…å­˜åœ°å€æ˜¯aï¼Œé‚£ä¹ˆå°±ä¼šä»¥aä¸ºé”®ï¼Œåœ¨è¿™ä¸ªweakè¡¨ä¸­æœç´¢ï¼Œæ‰¾åˆ°æ‰€æœ‰ä»¥aä¸ºé”®çš„weakå¯¹è±¡ï¼Œä»è€Œè®¾ç½®ä¸ºnilã€‚

(æ³¨ï¼šåœ¨ä¸‹æ–‡çš„ã€Šä½¿ç”¨runtime Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾å—ï¼Ÿã€‹é‡Œç»™å‡ºçš„â€œå¯¹è±¡çš„å†…å­˜é”€æ¯æ—¶é—´è¡¨â€ä¹Ÿæåˆ°__weakå¼•ç”¨çš„è§£é™¤æ—¶é—´ã€‚)
å…ˆçœ‹ä¸€ä¸‹runtimeé‡Œæºç çš„å®ç°ï¼š

	/**
	* The internal structure stored in the weak references table.
	* It maintains and stores
	* a hash set of weak references pointing to an object.
	* If out_of_line==0, the set is instead a small inline array.
	*/
	#define WEAK_INLINE_COUNT 4
	struct weak_entery_t {
		DisguisedPtr<objc_object> referent;
		union {
			struct {
				weak_referrer_t * referrers;
				uintptr_t				out_of_line : 1;
				uintptr_t				num_refs : PTR_MINUS_1;
				uintptr_t				mask;
				uintptr_t				mas_hash_displacement;
			};
			struct {
				//out_of_line=0 is LSB of one of these (don't care which)
				weak_referrer_t inline_referrers[WEAK_INLINE_COUNT];
			};
		};
	};
	
	/**
	* The global weak referrences table. Stores object ids as keys,
	* and weak_entry_t structs as their values.
	*/
	
	struct weak_table_t {
		weak_entry_t * weak_entries;
		size_t num_entries;
		uintptr_t mask;
		uintptr_t mas_hash_displacement;
	};

å…·ä½“å®Œæ•´å®ç°å‚ç…§[objc/objc-weak.h](https://opensource.apple.com/source/objc4/objc4-646/runtime/objc-weak.h)ã€‚
æˆ‘ä»¬å¯ä»¥è®¾è®¡ä¸€ä¸ªå‡½æ•°(ä¼ªä»£ç )æ¥è¡¨ç¤ºä¸Šè¿°æœºåˆ¶:

objc_storeWeak(&a, b)å‡½æ•°:

objc_storeWeakå‡½æ•°æŠŠç¬¬äºŒä¸ªå‚æ•°--èµ‹å€¼å¯¹è±¡(b)çš„å†…å­˜åœ°å€ä½œä¸ºé”®å€¼keyï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°--weakä¿®é¥°çš„å±æ€§å˜é‡(a)çš„å†…å­˜åœ°å€(&a)ä½œä¸ºvalueï¼Œæ³¨å†Œåˆ°weakè¡¨ä¸­ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°(b)ä¸º0(nil)ï¼Œé‚£ä¹ˆ(a)çš„å†…å­˜åœ°å€(&a)ä»weakè¡¨ä¸­åˆ é™¤ï¼Œä½ å¯ä»¥æŠŠobjc_storeWeak(&a, b)ç†è§£ä¸º:objc_storeWeak(value, key), å¹¶ä¸”å½“keyå˜nilï¼Œå°†valueç½®nilã€‚
åœ¨bénilæ—¶ï¼Œaå’ŒbæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œåœ¨bå˜nilæ—¶ï¼Œaå˜nilã€‚æ­¤æ—¶å‘aå‘é€æ¶ˆæ¯ä¸ä¼šå´©æºƒ:åœ¨Objective-Cä¸­å‘nilå‘é€æ¶ˆæ¯æ˜¯å®‰å…¨çš„ã€‚

è€Œå¦‚æœaæ˜¯ç”±assignä¿®é¥°çš„ï¼Œåˆ™:åœ¨bénilæ—¶ï¼Œaå’ŒbæŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œåœ¨bå˜nilæ—¶ï¼Œaè¿˜æ˜¯æŒ‡å‘è¯¥å†…å­˜åœ°å€ï¼Œå˜é‡æŒ‡é’ˆã€‚æ­¤æ—¶å‘aå‘é€æ¶ˆæ¯ææ˜“å´©æºƒã€‚

ä¸‹é¢æˆ‘ä»¬å°†åŸºäºobjc_storeWeak(&a, b)å‡½æ•°ï¼Œä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿ"runtimeå¦‚ä½•å®ç°weakå±æ€§":

	//ä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿ: runtimeå¦‚ä½•å®ç°weakå±æ€§
	//http://weibo.com/luohanchenyilong/
	//https://github.com/ChenYilong
	
	id obj1;
	objc_initweak(&obj1, obj);
	/*objå¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œå˜é‡ä½œç”¨åŸŸç»“æŸ*/
	objc_destoryWeak(&obj1);

ä¸‹é¢å¯¹ç”¨åˆ°çš„ä¸¤ä¸ªæ–¹æ³•objc_initWeakå’Œobjc_destoryWeakåšä¸‹è§£é‡Šï¼š
æ€»ä½“æ¥è¯´ï¼Œä½œç”¨æ˜¯: é€šè¿‡objc_initWeakå‡½æ•°åˆå§‹åŒ–"é™„æœ‰weakä¿®é¥°ç¬¦çš„å˜é‡(obj1)", åœ¨å˜é‡ä½œç”¨åŸŸç»“æŸæ—¶é€šè¿‡objc_destoryWeakå‡½æ•°é‡Šæ”¾è¯¥å˜é‡(obj1)ã€‚

ä¸‹é¢åˆ†åˆ«ä»‹ç»ä¸‹æ–¹æ³•çš„å†…éƒ¨å®ç°:objc_initWeakå‡½æ•°çš„å®ç°æ˜¯è¿™æ ·çš„:åœ¨å°†"é™„æœ‰weakä¿®é¥°ç¬¦çš„å˜é‡(obj1)"åˆå§‹åŒ–ä¸º0(nil)åï¼Œä¼šå°†"èµ‹å€¼å¯¹è±¡"ï¼ˆobjï¼‰ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨objc_storeWeakå‡½æ•°ã€‚

ojb1 = 0;
obj_storeWeak(&obj1, obj);
ä¹Ÿå°±æ˜¯è¯´:
>weakä¿®é¥°çš„æŒ‡é’ˆé»˜è®¤å€¼æ˜¯nil

ç„¶åobj_destoryWeakå‡½æ•°å°†0(nil)ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨objc_storeWeakå‡½æ•°ã€‚objc_storeWeak(&obj1, 0);å‰é¢çš„æºä»£ç ä¸ä¸‹åˆ—æºä»£ç ç›¸åŒã€‚

	// ä½¿ç”¨ä¼ªä»£ç æ¨¡æ‹Ÿ:/ runtimeå¦‚ä½•å®ç°weakå±æ€§
	// http://weibo.com/luohanchenyilong/
	// https://github.com/ChenYilong
	
	id obj1;
	obj1 = 0;
	objc_storeWeak(&obj1, obj);
	/*... objçš„å¼•ç”¨è®¡æ•°å˜ä¸º0ï¼Œè¢«ç½®nil...*/
	objc_storeWeak(&obj1, 0);

objc_storeWeakå‡½æ•°æŠŠç¬¬äºŒä¸ªå‚æ•°--èµ‹å€¼å¯¹è±¡(obj)çš„å†…å­˜åœ°å€ä½œä¸ºé”®å€¼ï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°--weakä¿®é¥°çš„å±æ€§å˜é‡(obj1)çš„å†…å­˜åœ°å€æ³¨å†Œåˆ°weakè¡¨ä¸­ã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°(obj)ä¸º0(nil)ï¼Œé‚£ä¹ˆæŠŠå˜é‡(obj1)çš„åœ°å€ä»weakè¡¨ä¸­åˆ é™¤ï¼Œåœ¨åé¢çš„ç›¸å…³ä¸€é¢˜ä¼šè¯¦è§£ã€‚

ä½¿ç”¨ä¼ªä»£ç æ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢æˆ‘ä»¬"çœŸæªå®å¼¹"çš„å®ç°ä¸‹:
>å¦‚ä½•ä¸ä½¿ç”¨weakä¿®é¥°çš„@propertyï¼Œæ‹¥æœ‰weakçš„æ•ˆæœ

æˆ‘ä»¬ä»setteræ–¹æ³•å…¥æ‰‹:
ï¼ˆæ³¨æ„ä»¥ä¸‹çš„cyl_runAtDeallocæ–¹æ³•å®ç°ä»…ç”¨äºæ¨¡æ‹ŸåŸç†ï¼Œå¦‚æœæƒ³ç”¨äºé¡¹ç›®ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘æ›´å¤æ‚çš„åœºæ™¯ï¼Œæƒ³åœ¨å®é™…é¡¹ç›®ä½¿ç”¨çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨æˆ‘å†™çš„ä¸€ä¸ªå°åº“ï¼Œå¯æ˜¯ä½¿ç”¨CocoaPodsåœ¨é¡¹ç›®ä¸­ä½¿ç”¨[CYLDeallocBlockExecutor](https://github.com/ChenYilong/CYLDeallocBlockExecutor)ï¼‰

	- (void)setObject:(NSObject *)object {
		objc_setAssociatedObject(self, "object", object, OBJC_ASSOCIATION_ASSIGN);
		[objcet cyl_runAtDealloc:^ {
			_object = nil;
		}];
	}

ä¹Ÿå°±æ˜¯æœ‰è¿™ä¸¤ä¸ªæ­¥éª¤:

1. åœ¨setteræ–¹æ³•ä¸­åšå¦‚ä¸‹è®¾ç½®:

		objc_setAssociatedObject(self, "object", object, OBJC_ASSOCIATION_ASSIGN);

2. åœ¨å±æ€§æ‰€æŒ‡çš„å¯¹è±¡é­åˆ°æ‘§æ¯æ—¶ï¼Œå±æ€§å€¼ä¹Ÿä¼šæ¸…ç©º(nil out)ã€‚åšåˆ°è¿™ç‚¹ï¼ŒåŒæ ·è¦å€ŸåŠ©runtimeï¼š

		// è¦æ‘§æ¯çš„å¯¹è±¡
		id objectToBeDeallocted;
		// objectWeWantToBeReleasedWhenThatHappens;
		objc_setAssociatedObject(objectedToBeDeallocted, someUniqueKey, objectWeWantToBeReleasedWhenThatHappens, OBJC_ASSOCIATION_RETAIN);

çŸ¥é“äº†æ€è·¯ï¼Œæˆ‘ä»¬å°±å¼€å§‹å®ç°cyl_runAtDeallocæ–¹æ³•ï¼Œå®ç°è¿‡ç¨‹åˆ†ä¸¤éƒ¨åˆ†:

ç¬¬ä¸€éƒ¨åˆ†ï¼šåˆ›å»ºä¸€ä¸ªç±»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ª"äº‹ä»¶":å½“ç›®æ ‡å¯¹è±¡æ‘§æ¯æ—¶ï¼ŒåŒæ—¶è¦å‘ç”Ÿçš„"äº‹ä»¶"ã€‚å€ŸåŠ©æ‰§è¡Œ"äº‹ä»¶"ã€‚
//.hæ–‡ä»¶

	// .hæ–‡ä»¶
	// http://weibo.com/luohanchenyilong/
	// https://github.com/ChenYilong
	// è¿™ä¸ªç±»ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªâ€œäº‹ä»¶â€ï¼šå½“ç›®æ ‡å¯¹è±¡é”€æ¯æ—¶ï¼ŒåŒæ—¶è¦å‘ç”Ÿçš„â€œäº‹ä»¶â€ã€‚å€ŸåŠ©blockæ‰§è¡Œâ€œäº‹ä»¶â€ã€‚
	
	typedef void (^voidBlock)(void);
	
	@interface CYLBlockExecutor : NSObject
	
	- (id)initWithBlock:(voidBlock)block;
	
	@end	

//.mæ–‡ä»¶

	// .mæ–‡ä»¶
	#import "CYLBlockExecutor.h"
	@interface CYLBlockExecutor() {
		voidBlock _block;
	}
	
	@implementation CYLBlockExecutor
	
	- (id)initWithBlock:(voidBlock)aBlock {
		self = [super init];
		if (self) {
			_block = [aBlock copy];
		}
		return self;
	}
	
	- (void)dealloc {
		_block ? _block() : nil;
	}
	
	@end

ç¬¬äºŒéƒ¨åˆ†ï¼šæ ¸å¿ƒä»£ç ï¼šåˆ©ç”¨runtimeå®ç°cyl_runArDeallocæ–¹æ³•

	// CYLNSObject+RunAtDealloc.hæ–‡ä»¶
	//	åˆ©ç”¨runtimeå®ç°cyl_runAtDeallocæ–¹æ³•
	
	#import "CYLBlockExecutor.h"
	
	const void * runArDeallocBlockKey = &runAtDeallocBlockKey;
	
	@interface NSObject ï¼ˆCLYRunAtDeallocï¼‰
	
	- (void)cyl_runAtDealloc:(voidBlock)block;
	
	@end
	
	//CYLNSObject+RunAtDealloc.mæ–‡ä»¶
	
	#import "CYLNSObject_RunAtDealloc.h"
	#import "CYLBlockExecutor.h"
	
	@implementation NSObject (CYLRunAtDealloc)
	
	- (void)cyl_runAtDealloc:(voidBlock)block {
		if (block) {
			CYLBlockExecutor * executor = [[CYLBlockExecutor alloc] initWithBlock:block];
			
			objc_setAssociatedObject(self, runAtDeallocBlockKey, executor, OBJC_ASSOCIATION_RETAIN);
		}
	}
	
	@end
		
* ##9.@propertyä¸­æœ‰å“ªäº›å±æ€§å…³é”®è¯
	
å¦‚æœéœ€è¦å®šä¹‰ä¸€ä¸ªinitå¼€å¤´çš„å±æ€§ï¼Œä½†é»˜è®¤ç”Ÿæˆçš„setterå’Œgetteræ–¹æ³•ä¹Ÿä¼šä»¥initå¼€å¤´ï¼Œè€Œç¼–è¯‘å™¨ä¼šæŠŠæ‰€æœ‰initå¼€å¤´çš„æ–¹æ³•å½“æˆåˆå§‹åŒ–æ–¹æ³•ï¼Œè€Œåˆå§‹åŒ–æ–¹æ³•åªèƒ½è¿”å›selfç±»å‹ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¼šæŠ¥é”™(copy newåŒç†):

	@property(nonatomic, strong, getter=p_initBy, setter=setP_initBy:) NSString * initBy;

å¦å¤–ä¹Ÿå¯ä»¥ç”¨å…³é”®å­—è¿›è¡Œç‰¹æ®Šè¯´æ˜ï¼Œæ¥é¿å…ç¼–è¯‘å™¨æŠ¥é”™:

	@property(nonatomic, readwrite, copy, null_resettable) NSString * initBy;
	- (NSString *)initBy __attribute__((objc_method_family(none)));
	
æ³¨æ„ï¼šå¾ˆå¤šäººä¼šè®¤ä¸ºå¦‚æœå±æ€§å…·å¤‡nonatomicç‰¹è´¨ï¼Œåˆ™ä¸ä½¿ç”¨â€œåŒæ­¥é”â€ã€‚å…¶å®åœ¨å±æ€§è®¾ç½®æ–¹æ³•ä¸­ä½¿ç”¨çš„æ˜¯è‡ªæ—‹é”ï¼Œè‡ªæ—‹é”ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š

	static inline void reallySetProperty(id self, SEL _cmd, id newValue, ptrdiff_t offset, bool atomic, bool copy, bool mutableCopy) {
		if (offset == 0) {
			object_setClass(self, newValue);
			return;
		}
		
		if oldValue;
		id *slot = (id *)((char *)self + offset);
		if (copy) {
			newValue = [newValue copyWithZone:nil];
		} else if (mutableCopy) {
			newValue = [newValue mutableCopyWithZone:nil];
		} else if () {
			if (*slot == newValue) return;
			newValue = objc_retain(newValue);
		}
		
		if (!atomic) {
			oldValue = *slot;
			*slot = newValue;
		} else {
			spinLock_t& slotLock = PropertyLocks[slot];
			slotlock.lock();
			oldValue = *slot;
			*slot = newValue();
			slotlock.unlock();
		}
		objc_release(oldValue);
	}	 
	
	void objc_setProperty(id self, SEL _cmd, ptrdiff_t offset, id newValue, BOOL atomic, signed char shouldCppy) {
		bool copy = (shouldCopy && shouldCopy != MUTABLE_COPY);
		bool mutableCopy = (shouldCopy == MUTABLE_COPY);
		reallySetProperty(self, _cmd, newValue, offset, atomic, copy, mutableCopy);
	}
	
* ##11.@synthesizeå’Œ@dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨

ä»¥å‰å¦‚æœæ²¡æœ‰æ‰‹åŠ¨åŠ å…¥settetå’Œgetteræ–¹æ³•ï¼Œéœ€è¦ä½¿ç”¨@synthesizeè®©ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆsetterå’Œgetteræ–¹æ³•ã€‚ç°åœ¨ä¸éœ€è¦äº†ã€‚
@dynamicå‘Šè¯‰ç¼–è¯‘å™¨å¼€å‘è€…è‡ªå·±ç”Ÿæˆsetterå’Œgetteræ–¹æ³•ä¸éœ€è¦ç¼–è¯‘å™¨æ¥è‡ªåŠ¨ç”Ÿæˆã€‚

* ##14.@synthesizeåˆæˆå®ä¾‹å˜é‡çš„è§„åˆ™æ˜¯ä»€ä¹ˆï¼Ÿå‡å¦‚propertyåä¸ºfoo,å­˜åœ¨ä¸€ä¸ªåä¸º_fooçš„å®ä¾‹å˜é‡ï¼Œé‚£ä¹ˆè¿˜ä¼šè‡ªåŠ¨åˆæˆæ–°å˜é‡å—?

æ€»ç»“ä¸‹@synthesizeåˆæˆå®ä¾‹å˜é‡çš„è§„åˆ™æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š

1. å¦‚æœæŒ‡å®šäº†æˆå‘˜å˜é‡çš„åç§°ï¼Œä¼šç”Ÿæˆä¸€ä¸ªæŒ‡å®šçš„åç§°çš„æˆå‘˜å˜é‡ï¼Œ
2. å¦‚æœè¿™ä¸ªæˆå‘˜å˜é‡å·²ç»å­˜åœ¨äº†å°±ä¸å†ç”Ÿæˆäº†ã€‚
3. å¦‚æœæ˜¯@synthesize foo;è¿˜ä¼šç”Ÿæˆä¸€ä¸ªåä¸ºfooçš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå°±æ˜¯è¯´

>å¦‚æœæ²¡æœ‰æŒ‡å®šæˆå‘˜å˜é‡çš„åç§°ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªå±æ€§åŒåçš„çš„æˆå‘˜å˜é‡ï¼Œ

4. å¦‚æœæ˜¯@synthesize foo = _foo;å°±ä¸ä¼šç”Ÿæˆæˆå‘˜å˜é‡äº†ã€‚

* ##15.åœ¨æœ‰äº†è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡ä¹‹åï¼Œ@synthesizeè¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ

åœ¨å›ç­”è¿™ä¸ªé—®é¢˜å‰ï¼Œæˆ‘ä»¬è¦ææ¸…æ¥šä¸€ä¸ªé—®é¢˜ï¼Œä»€ä¹ˆæƒ…å†µä¸ä¼šautosynthesize(è‡ªåŠ¨åˆæˆ)?

1. åŒäº‹é‡å†™äº†setterå’Œgetteræ—¶
2. é‡å†™äº†åªè¯»å±æ€§çš„getteræ—¶
3. ä½¿ç”¨äº†@dynamic
4. åœ¨@protocolä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§
5. åœ¨categoryä¸­å®šä¹‰çš„æ‰€æœ‰å±æ€§
6. é‡è½½çš„æ‰€æœ‰å±æ€§

å½“ä½ åœ¨å­ç±»ä¸­é‡è½½äº†çˆ¶ç±»ä¸­çš„å±æ€§ï¼Œä½ å¿…é¡»ä½¿ç”¨@synthesizeæ¥æ‰‹åŠ¨åˆæˆivarã€‚

é™¤äº†åä¸‰æ¡ï¼Œå¯¹å…¶ä»–å‡ ä¸ªæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºä¸€ä¸ªè§„å¾‹ï¼šå½“ä½ æƒ³æ‰‹åŠ¨ç®¡ç†@propertyçš„æ‰€æœ‰å†…å®¹æ—¶ï¼Œä½ å°±ä¼šé€šè¿‡å®ç°@propertyçš„æ‰€æœ‰"å­˜å–æ–¹æ³•"æˆ–è€…ä½¿ç”¨@dynamicæ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ï¼Œè¿™æ˜¯ç¼–è¯‘å™¨å°±ä¼šè®¤ä¸ºä½ æ‰“ç®—æ‰‹åŠ¨ç®¡ç†@propertyï¼Œäºæ˜¯ç¼–è¯‘å™¨å°±ç¦ç”¨äº†autosynthesis(è‡ªåŠ¨åˆæˆ)ã€‚

å› ä¸ºæœ‰äº†autosynthesize(è‡ªåŠ¨åˆæˆ)ï¼Œå¤§éƒ¨åˆ†å¼€å‘è€…å·²ç»ä¹ æƒ¯ä¸å»æ‰‹åŠ¨å®šä¹‰ivarï¼Œè€Œæ˜¯ä¾èµ–äºautosynthesizs(è‡ªåŠ¨åˆæˆ)ï¼Œä½†æ˜¯ä¸€æ—¦ä½ éœ€è¦ä½¿ç”¨ivarï¼Œè€Œautosynthesis(è‡ªåŠ¨åˆæˆ)åˆå¤±æ•ˆäº†ï¼Œå¦‚æœä¸å»æ‰‹åŠ¨å®šä¹‰ivarï¼Œé‚£ä¹ˆä½ å°±å¾—å€ŸåŠ©@synthesizeæ¥æ‰‹åŠ¨åˆæˆã€‚

å…¶å®@synthesizeè¿˜æœ‰ä¸€ä¸ªä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯ä¸å»ºè®®å¤§å®¶å»ä½¿ç”¨:

	@interface JERObject: NSObject
	@property (nonatomic, copy) NSString * title;
	@end
	
	@implementation UCNObject {
		// NSString  * _title;
	}
	
	//@synthesize title = _title;
	
	- (instancetype)init {
		self = [super init];
		if (self) {
			_title = @"";
		}
	}
	
	- (NSString *)title {
		return _title;
	}
	
	- (void)setTitle:(NSString *)title {
		_title = [title copy];
	}
	
	@end
	 
ç»“æœç¼–è¯‘å™¨æŠ¥é”™ï¼š

![](https://Jeremy1221.github.io/img/retain_cycle/synthesize.png)

* 19.ä¸€ä¸ªobjcå¯¹è±¡å¦‚ä½•è¿›è¡Œå†…å­˜å¸ƒå±€ï¼Ÿ(è€ƒè™‘æœ‰çˆ¶ç±»çš„æƒ…å†µ)

>æ‰€æœ‰çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œè‡ªå·±çš„æˆå‘˜å˜é‡éƒ½ä¼šå­˜æ”¾åœ¨è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„å­˜å‚¨ç©ºé—´ä¸­ã€‚
>æ¯ä¸€ä¸ªå¯¹è±¡å†…éƒ¨éƒ½æœ‰ä¸€ä¸ªisaæŒ‡é’ˆï¼ŒæŒ‡å‘ä»–çš„ç±»å¯¹è±¡ä¸­ï¼Œç±»å¯¹è±¡ä¸­å­˜æ”¾ç€æœ¬å¯¹è±¡çš„:

1. å¯¹è±¡æ–¹æ³•åˆ—è¡¨
2. æˆå‘˜å˜é‡çš„åˆ—è¡¨
3. å±æ€§åˆ—è¡¨

å®ƒå†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ªisaæŒ‡é’ˆæŒ‡å‘å…ƒå¯¹è±¡(meta class)ï¼Œå…ƒå¯¹è±¡å†…éƒ¨å­˜æ”¾çš„æ˜¯ç±»æ–¹æ³•åˆ—è¡¨ï¼Œç±»å¯¹è±¡å†…éƒ¨è¿˜æœ‰ä¸€ä¸ªsuperclassçš„æŒ‡é’ˆï¼ŒæŒ‡å‘ä»–çš„çˆ¶ç±»å¯¹è±¡ã€‚

æ¯ä¸ªObjective-Céƒ½æœ‰ç›¸åŒçš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º

![](https://Jeremy1221.github.io/img/retain_cycle/class.png)

ç¿»è¯‘è¿‡æ¥å°±æ˜¯

Objective-Cå¯¹è±¡çš„ç»“æ„å›¾ |
isaæŒ‡é’ˆ |
æ ¹ç±»çš„å®ä¾‹å˜é‡ |
å€’æ•°ç¬¬äºŒå±‚çˆ¶ç±»çš„å®ä¾‹å˜é‡ |
... |
çˆ¶ç±»çš„å®ä¾‹å˜é‡ |
ç±»çš„å®ä¾‹å˜é‡ |

| Name | Academy | score | 
| - | :-: | -: | 
| Harry Potter | Gryffindor| 90 | 
| Hermione Granger | Gryffindor | 100 | 
| Draco Malfoy | Slytherin | 90 |

* ##20.ä¸€ä¸ªobjcå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘ä»€ä¹ˆï¼Ÿæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ

æŒ‡å‘ä»–çš„ç±»å¯¹è±¡ï¼Œä»è€Œå¯ä»¥æ‰¾åˆ°å¯¹è±¡ä¸Šçš„æ–¹æ³•.

* ##21.ä¸‹é¢çš„ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ

		@implmentation Son : Father
		- (id)init {
			if (self = [super init]) {
				NSLog(@"%@", NSStringFromClass([self class]));
				NSLog(@"%@", NSStringFromClass([super class]))
			}
			return self;
		}
		@end

éƒ½è¾“å‡ºSon

è¿™ä¸ªé¢˜ç›®ä¸»è¦æ˜¯è€ƒå¯Ÿå…³äºObjective-Cä¸­å¯¹selfå’Œsuperçš„ç†è§£ã€‚
æˆ‘ä»¬éƒ½çŸ¥é“ï¼šselfæ˜¯ç±»çš„éšè—å‚æ•°ï¼ŒæŒ‡å‘å½“å‰è°ƒç”¨æ–¹æ³•çš„è¿™ä¸ªç±»çš„å®ä¾‹ã€‚é‚£superå‘¢ï¼Ÿ

å¾ˆå¤šäººä¼šæƒ³å½“ç„¶çš„è®¤ä¸º"superå’Œselfç±»ä¼¼ï¼Œåº”è¯¥æ˜¯æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆå§ï¼"ã€‚è¿™æ˜¯å¾ˆæ™®éçš„ä¸€ä¸ªè¯¯åŒºã€‚å…¶å®superæ˜¯ä¸€ä¸ªmagic keywordï¼Œå®ƒæœ¬è´¨æ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ ‡è¯†ç¬¦ï¼Œå’Œselfæ˜¯æŒ‡å‘çš„åŒä¸€ä¸ªæ¶ˆæ¯æ¥å—è€…ï¼ä»–ä»¬ä¸¤ä¸ªçš„ä¸åŒç‚¹åœ¨äºï¼šsuperä¼šå‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè°ƒç”¨classè¿™ä¸ªæ–¹æ³•æ—¶ï¼Œè¦å»çˆ¶ç±»çš„æ–¹æ³•è€Œä¸æ˜¯æœ¬ç±»é‡Œçš„ã€‚

ä¸Šé¢çš„ä¾‹å­ä¸ç®¡è°ƒç”¨[self class]è¿˜æ˜¯[super class]ï¼Œæ¥å—æ¶ˆæ¯çš„å¯¹è±¡éƒ½æ˜¯å½“å‰Son *xxxè¿™ä¸ªå¯¹è±¡ã€‚

å½“ä½¿ç”¨selfè°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šä»å½“å‰ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°±ä»çˆ¶ç±»ä¸­å†æ‰¾ï¼›è€Œå½“ä½¿ç”¨superæ—¶ï¼Œåˆ™ä»çˆ¶ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­å¼€å§‹æ‰¾ã€‚ç„¶åè°ƒç”¨çˆ¶ç±»çš„è¿™ä¸ªæ–¹æ³•ã€‚

è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆè¯´"ä¸æ¨èåœ¨initæ–¹æ³•ä¸­ä½¿ç”¨ç‚¹è¯­æ³•"ï¼Œå¦‚æœæƒ³è®¿é—®å®ä¾‹å˜é‡ivaråº”è¯¥ä½¿ç”¨ä¸‹åˆ’çº¿(_ivar),è€Œéç‚¹è¯­æ³•(self.ivar)ã€‚

ç‚¹è¯­æ³•(self.ivar)çš„åå¤„å°±æ˜¯å­ç±»æœ‰å¯èƒ½è¦†å†™setterã€‚å‡è®¾Personæœ‰ä¸€ä¸ªå­ç±»å«ChenPersonï¼Œè¯¥å­ç±»å¯èƒ½ä¼šè¦†å†™lastNameå±æ€§æ‰€å¯¹åº”çš„è®¾ç½®æ–¹æ³•:

@implementation

	- (instancetype)init {
		if (self = [super init]) {
			NSLog(@"ğŸ”´ç±»åä¸æ–¹æ³•å:%s(åœ¨ç¬¬%dè¡Œ)ï¼Œæè¿°:%@", __PRETTY_FUNCTION__, __LINE__, NSStringFromClass([self class]));
			NSLog(@"ğŸ”´ç±»åä¸æ–¹æ³•å:%s(åœ¨ç¬¬%dè¡Œ)ï¼Œæè¿°:%@"ï¼Œ __PRETTY__FUNCTION__, __LINE__, NSStringFromClass[super class]);
		} 
		return self;
	}
	
	- (void)setLastname:(NSString *)lastname {
		//è®¾ç½®æ–¹æ³•ä¸€ï¼šå¦‚æœsetteré‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œå°±å¯èƒ½å¼•èµ·å´©æºƒ
		//if (![lastname isEqualToString:@"é™ˆ"]) {
		//		[NSException raise:NSInvalidArgumentException format:@"å§“ä¸æ˜¯é™ˆ"];
		//}
		//		_lastname = lastname;
		
		_lastname = @"é™ˆ";
		NSLog(@"ğŸ”´ç±»åä¸æ–¹æ³•å:%s(åœ¨ç¬¬%dè¡Œ)ï¼Œæè¿°:%@", __PRETTY_FUNCTION__, __LINE__, @"ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆ?");
	}
	
åœ¨åŸºç±»Personçš„é»˜è®¤åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå¯èƒ½ä¼šå°†å§“æ°è®¾ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œæ­¤æ—¶ä½¿ç”¨ç‚¹è¯­æ³•(self.lastname)ä¹Ÿå³setterè®¾ç½®æ–¹æ³•ï¼Œé‚£ä¹ˆè°ƒç”¨å°†ä¼šæ˜¯å­ç±»çš„è®¾ç½®æ–¹æ³•ï¼Œå¦‚æœåœ¨åˆšåˆšçš„setterä»£ç ä¸­é‡‡ç”¨è®¾ç½®æ–¹æ³•ä¸€ï¼Œé‚£ä¹ˆå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œä¸ºäº†æ–¹ä¾¿é‡‡ç”¨æ‰“å°çš„æ–¹å¼å±•ç¤ºï¼Œç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬ä½¿ç”¨è®¾ç½®æ–¹æ³•äºŒã€‚

å¦‚æœåŸºç±»çš„ä»£ç æ˜¯è¿™æ ·çš„:

@implementation Person

	- (instancetype)init {
		if (self = [super init]) {
			self.lastname = @"";
			
		}
		return self;
	}
	
	- (void)setLastname:(NSString *)lastname {
		NSLog(@"ğŸ”´ç±»åä¸æ–¹æ³•å:%s(åœ¨ç¬¬%dè¡Œ),æè¿°:%@", __PRETTY_FUNCTION__, __LINE__, @"æ ¹æœ¬ä¸ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•");
	}

é‚£ä¹ˆæ‰“å°ç»“æœå°†ä¼šæ˜¯è¿™æ ·çš„:

	ğŸ”´ç±»åä¸æ–¹æ³•åï¼š -[ChenPerson setLastname:](åœ¨ç¬¬36è¡Œ)ï¼Œ æè¿°ï¼šä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæƒ³ä¸€ä¸‹ä¸ºä»€ä¹ˆ?
	ğŸ”´ç±»åä¸æ–¹æ³•åï¼š-[ChenPerson init](åœ¨ç¬¬19è¡Œ)ï¼Œæè¿°ï¼šChenPerson
	ğŸ”´ç±»åä¸æ–¹æ³•åï¼š-[ChenPerson init](åœ¨ç¬¬20è¡Œ)ï¼Œæè¿°ï¼šChenPerson

æ¥ä¸‹æ¥è®©æˆ‘ä»¬åˆ©ç”¨runtimeçš„ç›¸å…³çŸ¥è¯†æ¥éªŒè¯ä¸€ä¸‹superå…³é”®å­—çš„æœ¬è´¨ï¼Œä½¿ç”¨clangé‡å†™å‘½ä»¤ï¼š

	$clang -rewrite-objc test.m
	
å°†è¿™é“é¢˜ç›®ä¸­ç»™å‡ºä»£ç è¢«è½¬åŒ–ä¸º:

	NSLog((NSString *)& __NSConstantStringImpl__var_folders_gm_0jk35cwn1d3326x0061qym280000gn_T_main_a5cecc_mi_0, NSStringFromClass(((Class (*)(id, SEL))(void *)objc_msgSend)((id)self, sel_registerName("class"))));
	NSLog((NSString *)& __NSConstantStringImpl__var_folders_gm_0jk35cwn1d3326x0061qym280000gn_T_main_a5cecc_mi_1, NSStringFromClass(((Class (*)(__rw__objc_super *, SEL))(void *)objc_msgSendSuper)((__rw__objc_super){(id)self, (id)class_getSuperClass(objc_getClass("Son"))}, sel_registername("class"))));
	
ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°åœ¨è°ƒç”¨[self class]æ—¶ï¼Œä¼šè½¬åŒ–æˆobjc_msgSendå‡½æ•°ã€‚çœ‹å…ˆå‡½æ•°å®šä¹‰:
	
	id objc_msgSend(id self, SEL op, ...)
	
æˆ‘ä»¬æŠŠselfåšä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»ã€‚

è€Œåœ¨è°ƒç”¨[super class]æ˜¯ï¼Œä¼šè½¬åŒ–æˆobjc_msgSendSuperå‡½æ•°ã€‚çœ‹ä¸‹å‡½æ•°å®šä¹‰:

	id objc_msgSendSuper(struct objc_super * super, SEL op ...)
	
ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯objc_superè¿™æ ·ä¸€ä¸ªç»“æ„ä½“,å…¶å®šä¹‰å¦‚ä¸‹ï¼š

	struct objc_super {
		__unsafe__unretained id receiver;
		__unsafe__unretained Class super_class;
	};
	
ç»“æ„ä½“æœ‰ä¸¤ä¸ªæˆå‘˜ï¼Œç¬¬ä¸€ä¸ªæˆå‘˜æ˜¯receiverï¼Œç±»ä¼¼ä¸Šé¢çš„objc_msgSendå‡½æ•°ç¬¬ä¸€ä¸ªå‚æ•°selfã€‚ç¬¬äºŒä¸ªæˆå‘˜æ˜¯è®°å½•å½“å‰ç±»çš„çˆ¶ç±»æ˜¯ä»€ä¹ˆã€‚

æ‰€ä»¥ï¼Œå½“è°ƒç”¨[self class]æ—¶ï¼Œå®é™…å…ˆè°ƒç”¨çš„æ˜¯objc_msgSendå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯Sonå½“å‰çš„è¿™ä¸ªå®ä¾‹ï¼Œç„¶åå†Sonè¿™ä¸ªç±»é‡Œé¢å»æ‰¾- (Class)classè¿™ä¸ªæ–¹æ³•ï¼Œæ²¡æœ‰ï¼Œå»çˆ¶ç±»Fatheré‡Œæ‰¾ï¼Œä¹Ÿæ²¡æœ‰ï¼Œæœ€åå†NSObjectç±»ä¸­å‘ç°è¿™ä¸ªæ–¹æ³•ã€‚è€Œ-(Class)classçš„å®ç°å°±æ˜¯è¿”å›selfçš„ç±»åˆ«ï¼Œæ•…ä¸Šè¿°è¾“å‡ºç»“æœä¸ºSonã€‚

objc Runtimeå¼€æºä»£ç å¯¹-(Class)classæ–¹æ³•çš„å®ç°:

	- (Class)class {
		return object_getClass(self);
	}
	
è€Œå½“è°ƒç”¨[super class]æ—¶,ä¼šè½¬æ¢æˆobjc_msgSendSuperå‡½æ•°ã€‚ç¬¬ä¸€æ­¥å…ˆæ„é€ objc_superç»“æ„ä½“ï¼Œç»“æ„ä½“ç¬¬ä¸€ä¸ªæˆå‘˜å°±æ˜¯selfã€‚ç¬¬äºŒä¸ªæˆå‘˜æ˜¯(id)class_getSuperClass("Son"),å®é™…è¯¥å‡½æ•°è¾“å‡ºç»“æ„ä¸ºFatherã€‚

ç¬¬äºŒæ­¥æ˜¯å»Fatherè¿™ä¸ªç±»é‡Œå»æ‰¾ -(Class)classï¼Œæ²¡æœ‰ï¼Œç„¶åå»NSObjectç±»å»æ‰¾ï¼Œæ‰¾åˆ°äº†ï¼Œæœ€åå†…éƒ¨æ˜¯ä½¿ç”¨objc_msgSend(objc_super->receiver, @selector(class))å»è°ƒç”¨ï¼Œæ­¤æ—¶å·²ç»å’Œ[self class]è°ƒç”¨ç›¸åŒäº†ï¼Œæ•…ä¸Šè¿°è¾“å‡ºç»“æœä»ç„¶è¿”å›Sonã€‚

å‚è€ƒé“¾æ¥[åˆ¨æ ¹é—®åº•Objectiveï¼C Runtimeï¼ˆ1ï¼‰ï¼ Self & Super](http://chun.tips/blog/2014/11/05/bao-gen-wen-di-objective%5Bnil%5Dc-runtime(1)%5Bnil%5D-self-and-super/)

* ##22.runtimeå¦‚ä½•é€šè¿‡selectoræ‰¾åˆ°å¯¹åº”çš„IMPåœ°å€(åˆ†åˆ«è€ƒè™‘ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•)

æ¯ä¸€ä¸ªç±»å¯¹è±¡ä¸­éƒ½æœ‰ä¸€ä¸ªæ–¹æ³•åˆ—è¡¨ï¼Œæ–¹æ³•åˆ—è¡¨ä¸­è®°å½•ç€æ–¹æ³•çš„åç§°ï¼Œæ–¹æ³•å®ç°ï¼Œä»¥åŠå‚æ•°ç±»å‹ï¼Œå…¶å®selectoræœ¬è´¨å°±æ˜¯æ–¹æ³•åç§°ï¼Œé€šè¿‡è¿™ä¸ªæ–¹æ³•åç§°å°±å¯ä»¥åœ¨æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°ã€‚

* ##23.ä½¿ç”¨runtime Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾å—ï¼Ÿ

æ— è®ºåœ¨ARCè¿˜æ˜¯MRCä¸‹å‡ä¸éœ€è¦

[2011å¹´ç‰ˆæœ¬çš„Apple API å®˜æ–¹æ–‡æ¡£ - Associative References](https://web.archive.org/web/20120818164935/http://developer.apple.com/library/ios/#/web/20120820002100/http://developer.apple.com/library/ios/documentation/cocoa/conceptual/objectivec/Chapters/ocAssociativeReferences.html)

	static char overviewKey;
	
	NSArray * array = [[NSArray alloc] initWithObjects:@"One", @"Two", @"Thress", nil];
	NSString * overview = [[NSString alloc] initWithFormat:@"%@", First three numbers];
	
	objc_setAssociatedObject (
		array,
		&overviewKey,
		overview,
		OBJC_ASSOCIATION_RETAIN
	);
	
	//point 1
	[overview release];
	//point 2
	[array release];
	
æ–‡æ¡£æŒ‡å‡º
>At point 1,the string overview is still valid because the OBJC_ASSOICATION_RETAIN policy specifies that the array retains the assoicated object.When the array is deallocated,however(at point 2),overview is released and so in this case also deallocated.

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨[array release]ä¹‹åï¼Œoverviewå°±ä¼šè¢«releaseé‡Šæ”¾æ‰äº†ã€‚

æ—¢ç„¶ä¼šè¢«é”€æ¯ï¼Œé‚£ä¹ˆå…·ä½“åœ¨ä»€ä¹ˆæ—¶é—´ç‚¹å‘¢ï¼Ÿ
>æ ¹æ®[WWDC 2011, Session 322 (ç¬¬36åˆ†22ç§’)](https://developer.apple.com/videos/wwdc/2011/#322-video)ä¸­å‘å¸ƒçš„å†…å­˜é”€æ¯æ—¶é—´è¡¨ï¼Œè¢«å…³è”çš„å¯¹è±¡åœ¨ç”Ÿå‘½å‘¨æœŸå†…è¦æ¯”å¯¹è±¡æœ¬èº«é‡Šæ”¾çš„æ™šå¾ˆå¤šã€‚å®ƒä»¬ä¼šåœ¨è¢«NSObject-deallocè°ƒç”¨çš„object_dispose()æ–¹æ³•ä¸­é‡Šæ”¾ã€‚

å¯¹è±¡çš„å†…å­˜é”€æ¯æ—¶é—´è¡¨ï¼Œåˆ†ä¸ºå››ä¸ªæ­¥éª¤:

#####1.è°ƒç”¨-releaseå¼•ç”¨è®¡æ•°å˜ä¸º0

* å¯¹è±¡æ­£åœ¨è¢«é”€æ¯ï¼Œç”Ÿå‘½å‘¨æœŸå³å°†ç»“æŸ.
* ä¸èƒ½å†æœ‰æ–°çš„ __weakå¼±å¼•ç”¨ï¼Œå¦åˆ™å°†æŒ‡å‘nil.
* è°ƒç”¨[self dealloc]

#####2. å­ç±»è°ƒç”¨ -dealloc
* ç»§æ‰¿å…³ç³»ä¸­æœ€åº•å±‚çš„å­ç±»åœ¨è°ƒç”¨-dealloc
* å¦‚æœæ˜¯MRCä»£ç åˆ™ä¼šæ‰‹åŠ¨é‡Šæ”¾å®ä¾‹å˜é‡(ivars)
* ç»§æ‰¿å…³ç³»ä¸­æ¯ä¸€æ¬¡çš„çˆ¶ç±»éƒ½åœ¨è°ƒç”¨ -dealloc

#####3. NSObject è°ƒ -dealloc
* åªåšä¸€ä»¶äº‹è°ƒç”¨Objective-C runtime ä¸­çš„ object_dispose()æ–¹æ³•

#####4. è°ƒç”¨object_dispose()
* ä¸ºC++çš„å®ä¾‹å˜é‡è°ƒç”¨destructors
* ä¸ºARCçŠ¶æ€ä¸‹çš„å®ä¾‹å˜é‡(ivars)è°ƒç”¨-release
* è§£é™¤æ‰€æœ‰ä½¿ç”¨runtime associateæ–¹æ³•å…³è”çš„å¯¹è±¡
* è§£é™¤æ‰€æœ‰ __weakå¼•ç”¨
* è°ƒç”¨free()

å¯¹è±¡çš„å†…å­˜é”€æ¯æ—¶é—´è¡¨:[å‚è€ƒé“¾æ¥](http://stackoverflow.com/a/10843510/3395008)

* ##24.objcä¸­çš„ç±»æ–¹æ³•å’Œå®ä¾‹æ–¹æ³•æœ‰ä»€ä¹ˆæœ¬è´¨åŒºåˆ«å’Œè”ç³»ï¼Ÿ

ç±»æ–¹æ³•ï¼š
1. ç±»æ–¹æ³•å±äºç±»å¯¹è±¡çš„
2. ç±»æ–¹æ³•åªèƒ½é€šè¿‡ç±»å¯¹è±¡è°ƒç”¨
3. ç±»æ–¹æ³•ä¸­çš„selfæ˜¯ç±»å¯¹è±¡
4. ç±»æ–¹æ³•å¯ä»¥è°ƒç”¨å…¶ä»–çš„ç±»æ–¹æ³•
5. ç±»æ–¹æ³•ä¸­ä¸èƒ½è®¿é—®æˆå‘˜å˜é‡
6. ç±»æ–¹æ³•ä¸­ä¸èƒ½ç›´æ¥è°ƒç”¨å¯¹è±¡æ–¹æ³•

å®ä¾‹æ–¹æ³•:
1. å®ä¾‹æ–¹æ³•æ˜¯å±äºå®ä¾‹å¯¹è±¡çš„
2. å®ä¾‹æ–¹æ³•åªèƒ½é€šè¿‡å®ä¾‹å¯¹è±¡è°ƒç”¨
3. å®ä¾‹æ–¹æ³•ä¸­çš„selfæ˜¯å®ä¾‹å¯¹è±¡
4. å®ä¾‹æ–¹æ³•ä¸­å¯ä»¥è®¿é—®æˆå‘˜å˜é‡
5. å®ä¾‹æ–¹æ³•ä¸­ç›´æ¥è°ƒç”¨å®ä¾‹æ–¹æ³•
6. å®ä¾‹æ–¹æ³•ä¹Ÿå¯ä»¥è°ƒç”¨ç±»æ–¹æ³•(é€šè¿‡ç±»å)

##new test 2 down
1. _objc_msgForward å‡½æ•°æ˜¯åšä»€ä¹ˆçš„ï¼Œç›´æ¥è°ƒç”¨å®ƒå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
2. runtimeå¦‚ä½•å®ç°weakå˜é‡çš„è‡ªåŠ¨ç½®nilï¼Ÿ
3. èƒ½å¦å‘ç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ
4. runloopå’Œçº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»
5. runloopçš„modeä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
6. ä»¥+scheduledTimerWithTimeInterval...çš„æ–¹å¼è§¦çŠ¯çš„timerï¼Œåœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚åœå›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿ
7. çŒœæƒ³runloopå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
8. objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å†…å­˜å¯¹è±¡
9. ARCé€šè¿‡ä»€ä¹ˆæ–¹å¼å¸®åŠ©å¼€å‘è€…ç®¡ç†å†…å­˜
10. ä¸æ‰‹åŠ¨æŒ‡å®šautoreleasepoolçš„å‰æä¸‹ï¼Œä¸€ä¸ªautoreleasepoolå¯¹è±¡åœ¨ä»€ä¹ˆæ—¶åˆ»é‡Šæ”¾?(æ¯”å¦‚åœ¨ä¸€ä¸ªvcçš„viewdidloadä¸­åˆ›å»º)
11. BAD_ACCESSåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°
12. è‹¹æœæ˜¯å¦‚ä½•å®ç°autoreleasepoolçš„
13. ä½¿ç”¨blockæ—¶ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¼•ç”¨å¾ªç¯å¼•ç”¨ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ
14. åœ¨blockå†…å¦‚ä½•ä¿®æ”¹blockå¤–éƒ¨å˜é‡
15. ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block api(å¦‚UIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶)ï¼Œæ˜¯å¦ä¹Ÿè€ƒè™‘å¼•ç”¨å¾ªç¯é—®é¢˜ï¼Ÿ
16. GCDçš„é˜Ÿåˆ—(dispatch_queue_t)åˆ†å“ªä¸¤ç§ç±»å‹
17. å¦‚ä½•ç”¨GCDåŒæ­¥è‹¥å¹²ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Ÿ(å¦‚æ ¹æ®è‹¥å¹²ä¸ªurlå¼‚æ­¥åŠ è½½å¤šå¼ å›¾ç‰‡ï¼Œç„¶ååœ¨éƒ½ä¸‹è½½å®Œæˆååˆæˆä¸€å¼ æ•´å›¾)
18. dispatch_barrier_asyncçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ
19. è‹¹æœä¸ºä»€ä¹ˆè¦åºŸå¼ƒdispatch_get_current_queue?
20. ä»¥ä¸‹ä»£ç è¿è¡Œç»“æ„å¦‚ä½•ï¼Ÿ
21. addObserver:forKeyPath:options:context:å„ä¸ªå‚æ•°çš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œobserverä¸­éœ€è¦å®ç°å“ªä¸ªæ–¹æ³•æ‰èƒ½è·å¾—KVOå›è°ƒ?
22. å¦‚ä½•æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªvalueçš„KVO
23. è‹¥ä¸€ä¸ªç±»æœ‰å®ä¾‹å˜é‡NSString * _foo, è°ƒç”¨setValue:forKey:æ—¶ï¼Œå¯ä»¥ä»¥fooè¿˜æ˜¯_fooä½œä¸ºkeyï¼Ÿ
24. KVCçš„keyPathä¸­çš„é›†åˆè¿ç®—ç¬¦å¦‚ä½•ä½¿ç”¨?
25. KVCå’ŒKVOçš„keyPathä¸€å®šæ˜¯å±æ€§å—ï¼Ÿ
26. å¦‚ä½•å…³é—­é»˜è®¤çš„KVOçš„é»˜è®¤å®ç°ï¼Œå¹¶è¿›å…¥è‡ªå®šä¹‰çš„KVOå®ç°ï¼Ÿ
27. appleç”¨ä»€ä¹ˆæ–¹å¼å®ç°ä¸€ä¸ªå¯¹è±¡çš„KVOï¼Ÿ
28. IBOutletè¿å‡ºæ¥çš„æ˜¯å›¾å±æ€§ä¸ºä»€ä¹ˆå¯ä»¥è¢«è®¾ç½®æˆweakï¼Ÿ
29. IBä¸­User Defined Runtime Attributeså¦‚ä½•ä½¿ç”¨ï¼Ÿ
30. å¦‚ä½•è°ƒè¯•BAD_ACCESSé”™è¯¯
31. lldb(gdb)å¸¸ç”¨çš„è°ƒè¯•å‘½ä»¤ï¼Ÿ

* ##1._objc_msgForwardå‡½æ•°æ˜¯åšä»€ä¹ˆçš„ï¼Œç›´æ¥è°ƒç”¨å®ƒå°†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

>_objc_msgForwardæ˜¯IMPç±»å‹ï¼Œç”¨äºæ¶ˆæ¯è½¬å‘çš„:å½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®ç°çš„æ—¶å€™ï¼Œ_objc_msgForwardä¼šå°è¯•åšæ¶ˆæ¯è½¬å‘ã€‚

æˆ‘ä»¬å¯ä»¥è¿™æ ·åˆ›å»ºä¸€ä¸ª_objc_msgForwardå¯¹è±¡ï¼š

	IMP msgForwardIMP = _objc_msgForward;
	
åœ¨ä¸Šç¯‡çš„ã€Šobjcå‘ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯[obj foo]å’Œobjc_msgSendå‡½æ•°ä¹‹é—´æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿã€‹æ›¾æåˆ°objc_msgSendåœ¨"æ¶ˆæ¯ä¼ é€’"ä¸­çš„ä½œç”¨ã€‚åœ¨â€œæ¶ˆæ¯ä¼ é€’â€è¿‡ç¨‹ä¸­ï¼Œobjc_msgSendçš„åŠ¨ä½œæ¯”è¾ƒæ¸…æ™°ï¼šé¦–å…ˆåœ¨Classä¸­çš„ç¼“å­˜æŸ¥æ‰¾IMP(æ²¡ç¼“å­˜åˆ™åˆå§‹åŒ–ç¼“å­˜)ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œåˆ™å‘çˆ¶ç±»çš„ClassæŸ¥æ‰¾ã€‚å¦‚æœä¸€ç›´æ‰¾åˆ°æ ¹ç±»ä»æ—§æ²¡æœ‰å®ç°ï¼Œåˆ™ç”¨_objc_msgForwardå‡½æ•°æŒ‡é’ˆä»£æ›¿IMPã€‚æœ€åæ‰§è¡Œè¿™ä¸ªIMP

Objective-Cè¿è¡Œæ—¶æ˜¯å¼€æºçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒçš„å®ç°ã€‚æ‰“å¼€[Apple Open Source é‡ŒMacä»£ç é‡Œçš„objåŒ… ](http://www.opensource.apple.com/tarballs/objc4/)ä¸‹è½½ä¸€ä¸ªæœ€æ–°çš„ç‰ˆæœ¬ï¼Œæ‰¾åˆ°objc-runtime-new.mm,è¿›å…¥ä¹‹åæœç´¢_objc_msgForwardã€‚


å¯¹objc-runtime-new.mmæ–‡ä»¶é‡Œä¸_objc_msgForwardæœ‰å…³çš„ä¸‰ä¸ªå‡½æ•°ä½¿ç”¨ä¼ªä»£ç å±•ç¤ºå¦‚ä¸‹:

	id objc_msgSend(id self, SEL op, ...) {
		if (!self) return nil;
			IMP imp = class_getMethodImplementation(self->isa, SEL op);
			imp(self, op, ...);	//è°ƒç”¨è¿™ä¸ªå‡½æ•° ä¼ªä»£ç 
	}
	
	//æŸ¥æ‰¾IMP
	IMP class_getMethodImplementation(Class cls, SEL sel) {
		if (!cls || !sel) return nil;
		IMP imp = lookupImpOrNil(cls, sel);
		if (!imp) return _objc_msgForward; //_objc_msgForward ç”¨äºæ¶ˆæ¯è½¬å‘
		return imp;
	}
	
	IMP lookupImpOrNil(Class cls, SEL sel) {
		if (!cls->initialize()) {
			_class_initialize(cls);
		}
		
		Class curClass = cls;
		IMP imp = nil;
		do {
			if (!curClass) break;
			if (!curClass->cache) fill_cache(cls, curClass);
			imp = cache_getImp(curClass, sel);
			if (imp)break;
		} while (curClass = curClass->superClass);
		return imp;
	}
	
è™½ç„¶Appleæ²¡æœ‰å…¬å¼€_objc_msgForwardçš„å®ç°æºç ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯èƒ½å¾—å‡ºç»“è®º:
>\_objc_msgFowardæ˜¯ä¸€ä¸ªå‡½æ•°æŒ‡é’ˆï¼ˆå’ŒIMPçš„ç±»å‹ä¸€æ ·ï¼‰ï¼Œæ˜¯ç”¨äºæ¶ˆæ¯è½¬å‘çš„ï¼šå½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®ç°çš„æ—¶å€™ï¼Œ_objc_msgForwardä¼šå°è¯•åšæ¶ˆæ¯è½¬å‘ã€‚

ä¸ºäº†å±•ç¤ºæ¶ˆæ¯è½¬å‘çš„å…·ä½“åŠ¨ä½œï¼Œè¿™é‡Œå°è¯•å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡é”™è¯¯çš„æ¶ˆæ¯ï¼Œå¹¶æŸ¥çœ‹ä¸€ä¸‹_objc_msgForwardæ˜¯å¦‚ä½•è¿›è¡Œè½¬å‘çš„ã€‚

é¦–å…ˆå¼€å¯è°ƒè¯•æ¨¡å¼ã€æ‰“å°å‡ºæ‰€æœ‰è¿è¡Œæ—¶å‘é€çš„æ¶ˆæ¯ï¼šå¯ä»¥åœ¨ä»£ç é‡Œæ‰§è¡Œä¸‹é¢çš„æ–¹æ³•ï¼š

	(void)instrumentObjcMessageSends(YES);

æˆ–è€…æ–­ç‚¹æš‚åœç¨‹åºè¿è¡Œï¼Œå¹¶åœ¨gdbä¸­è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼š

	call (void)instrumentObjcMessageSends(YES)
	
ä»¥ç¬¬äºŒç§ä¸ºä¾‹ï¼Œæ“ä½œå¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://Jeremy1221.github.io/img/retain_cycle/msgSend.png)

ä¹‹åï¼Œè¿è¡Œæ—¶å‘é€çš„æ‰€æœ‰æ¶ˆæ¯éƒ½ä¼šæ‰“å°åˆ°/tmp/msgSend-xxxxæ–‡ä»¶é‡Œäº†ã€‚

ç»ˆç«¯ä¸­è¾“å…¥å‘½ä»¤å‰å¾€:

	open /private/tmp
	
![](https://Jeremy1221.github.io/img/retain_cycle/tmpFile.png)

å¯èƒ½çœ‹åˆ°æœ‰å¤šæ¡ï¼Œæ‰¾åˆ°æœ€æ–°ç”Ÿæˆçš„ï¼ŒåŒå‡»æ‰“å¼€

åœ¨æ¨¡æ‹Ÿå™¨ä¸Šæ‰§è¡Œä»¥ä¸‹è¯­å¥(è¿™ä¸€å¥—è°ƒè¯•æ–¹æ¡ˆä»…ç”¨äºæ¨¡æ‹Ÿå™¨ï¼ŒçœŸæœºä¸å¯ç”¨ï¼Œå…³äºè¯¥è°ƒè¯•æ–¹æ¡ˆçš„æ‹“å±•é“¾æ¥:[ Can the messages sent to an object in Objective-C be monitored or printed out? ](http://stackoverflow.com/a/10750398/3395008)),å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡é”™è¯¯çš„æ¶ˆæ¯:

	int main(int argc, char * argv[]) {
		@autoreleasepool {
			Test * test = [[Test alloc] init];
			[test performSelector:(@selector(doSomething))];
			return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
		}
	}
	
![](https://Jeremy1221.github.io/img/retain_cycle/msgForward.png)

ä½ å¯ä»¥åœ¨/tmp/msgSend-xxxxï¼ˆæˆ‘è¿™ä¸€æ¬¡æ˜¯/tmp/msgSend-89805ï¼‰æ–‡ä»¶é‡Œï¼Œçœ‹åˆ°æ‰“å°å‡ºæ¥:

![](https://Jeremy1221.github.io/img/retain_cycle/forwardTmpFile.png)
	
ç»“åˆ[ã€ŠNSObjectå®˜æ–¹æ–‡æ¡£ã€‹](https://developer.apple.com/library/prerelease/watchos/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/#//apple_ref/doc/uid/20000050-SW11)ï¼Œæ’é™¤æ‰NSObjectåšçš„äº‹ï¼Œå‰©ä¸‹çš„å°±æ˜¯_objc_msgForwardæ¶ˆæ¯è½¬å‘åšçš„å‡ ä»¶äº‹:

1. è°ƒç”¨resolveInstanceMethod:æ–¹æ³•(æˆ–resolveClassMethod:)ã€‚å…è®¸ç”¨æˆ·åœ¨æ­¤æ—¶ä¸ºè¯¥ClassåŠ¨æ€æ·»åŠ å®ç°ã€‚å¦‚æœæœ‰å®ç°äº†ï¼Œåˆ™è°ƒç”¨å¹¶è¿”å›YESï¼Œé‚£ä¹ˆé‡æ–°å¼€å§‹objc_msgSendæµç¨‹ã€‚è¿™ä¸€æ¬¡å¯¹è±¡ä¼šå½±å“è¿™ä¸ªé€‰æ‹©å™¨ï¼Œä¸€èˆ¬æ˜¯å› ä¸ºå®ƒå·²ç»è°ƒç”¨è¿‡class_addMethodã€‚å¦‚æœä»æ²¡å®ç°ï¼Œç»§ç»­ä¸‹é¢çš„åŠ¨ä½œã€‚
2. è°ƒç”¨forwardingTargetForSelector:æ–¹æ³•ï¼Œå°è¯•æ‰¾åˆ°ä¸€ä¸ªèƒ½å“åº”è¯¥æ¶ˆæ¯çš„å¯¹è±¡ã€‚å¦‚æœè·å–åˆ°ï¼Œåˆ™ç›´æ¥æŠŠæ¶ˆæ¯è½¬å‘ç»™å®ƒï¼Œè¿”å›é nil å¯¹è±¡ã€‚å¦åˆ™è¿”å› nil ï¼Œç»§ç»­ä¸‹é¢çš„åŠ¨ä½œã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸è¦è¿”å› self ï¼Œå¦åˆ™ä¼šå½¢æˆæ­»å¾ªç¯ã€‚
3. è°ƒç”¨methodSignatureForSelector:æ–¹æ³•ï¼Œå°è¯•è·å¾—ä¸€ä¸ªæ–¹æ³•ç­¾åã€‚å¦‚æœè·å–ä¸åˆ°ï¼Œåˆ™ç›´æ¥è°ƒç”¨doesNotRecognizeSelectoræŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœèƒ½è·å–ï¼Œåˆ™è¿”å›énilï¼šåˆ›å»ºä¸€ä¸ª NSlnvocation å¹¶ä¼ ç»™forwardInvocation:ã€‚
4. è°ƒç”¨forwardInvocation:æ–¹æ³•ï¼Œå°†ç¬¬3æ­¥è·å–åˆ°çš„æ–¹æ³•ç­¾ååŒ…è£…æˆ Invocation ä¼ å…¥ï¼Œå¦‚ä½•å¤„ç†å°±åœ¨è¿™é‡Œé¢äº†ï¼Œå¹¶è¿”å›éniã€‚
5. è°ƒç”¨doesNotRecognizeSelector: ï¼Œé»˜è®¤çš„å®ç°æ˜¯æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœç¬¬3æ­¥æ²¡èƒ½è·å¾—ä¸€ä¸ªæ–¹æ³•ç­¾åï¼Œæ‰§è¡Œè¯¥æ­¥éª¤ã€‚

ä¸Šé¢å‰4ä¸ªæ–¹æ³•å‡æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œå¼€å‘è€…å¯ä»¥overrideï¼Œç”± runtime æ¥è°ƒç”¨ã€‚æœ€å¸¸è§çš„å®ç°æ¶ˆæ¯è½¬å‘ï¼šå°±æ˜¯é‡å†™æ–¹æ³•3å’Œ4ï¼Œåæ‰ä¸€ä¸ªæ¶ˆæ¯æˆ–è€…ä»£ç†ç»™å…¶ä»–å¯¹è±¡éƒ½æ˜¯æ²¡é—®é¢˜çš„

ä¹Ÿå°±æ˜¯è¯´_objc_msgForwardåœ¨è¿›è¡Œæ¶ˆæ¯è½¬å‘çš„è¿‡ç¨‹ä¸­ä¼šæ¶‰åŠä»¥ä¸‹è¿™å‡ ä¸ªæ–¹æ³•ï¼š

1. resolveInstanceMethod:æ–¹æ³• (æˆ– resolveClassMethod:)ã€‚
2. forwardingTargetForSelector:æ–¹æ³•
3. methodSignatureForSelector:æ–¹æ³•
4. forwardInvocation:æ–¹æ³•
5. doesNotRecognizeSelector: æ–¹æ³•
	
ç›´æ¥è°ƒç”¨_objc_msgForwardå°†ä¼šå‘ç”Ÿä»€ä¹ˆ

ç›´æ¥è°ƒç”¨_objc_msgForwardæ˜¯éå¸¸å±é™©çš„äº‹ï¼Œå¦‚æœç”¨ä¸å¥½ä¼šç›´æ¥å¯¼è‡´ç¨‹åºcrashï¼Œä½†æ˜¯å¦‚æœç”¨çš„å¥½ï¼Œèƒ½åšå¾ˆå¤šéå¸¸é…·çš„äº‹ã€‚

æ­£å¦‚å‰æ–‡æ‰€è¯´:
>\_objc_msgForwardæ˜¯IMPç±»å‹ï¼Œç”¨äºæ¶ˆæ¯è½¬å‘çš„ï¼šå½“å‘ä¸€ä¸ªå¯¹è±¡å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œä½†å®ƒå¹¶æ²¡æœ‰å®ç°çš„æ—¶å€™ï¼Œ_objc_msgForwardä¼šå°è¯•åšæ¶ˆæ¯è½¬å‘ã€‚

å¦‚ä½•è°ƒç”¨_objc_msgForwardï¼Ÿ_objc_msgForwardéš¶å±äºCè¯­è¨€ï¼Œæœ‰ä¸‰ä¸ªå‚æ•°:

| _objc_msgForwardå‚æ•° | ç±»å‹
|æ‰€å±å¯¹è±¡ |idç±»å‹
|æ–¹æ³•å | SELç±»å‹
|å¯å˜å‚æ•° |å¯å˜å‚æ•°ç±»å‹
	
é¦–å…ˆäº†è§£ä¸‹å¦‚ä½•è°ƒç”¨IMPç±»å‹çš„æ–¹æ³•ï¼ŒIMPç±»å‹æ˜¯å¦‚ä¸‹æ ¼å¼ï¼š
ä¸ºäº†ç›´è§‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®šä¹‰ä¸€ä¸ªIMPç±»å‹ï¼š
	
	typedef void (*voidIMP)(id, SEL, ...)
	
ä¸€æ—¦è°ƒç”¨_objc_msgForwardï¼Œå°†è·³è¿‡æŸ¥æ‰¾IMPçš„è¿‡ç¨‹ï¼Œç›´æ¥å‡ºå‘æ¶ˆæ¯è½¬å‘ï¼Œ

å¦‚æœè°ƒç”¨äº†_objc_msgForward,å³ä½¿è¿™ä¸ªå¯¹è±¡ç¡®å®å·²ç»å®ç°äº†è¿™ä¸ªæ–¹æ³•ï¼Œä½ ä¹Ÿä¼šå‘Šè¯‰objc_msgSend:
>"æˆ‘æ²¡æœ‰åœ¨è¿™ä¸ªå¯¹è±¡é‡Œæ‰¾åˆ°è¿™ä¸ªæ–¹æ³•çš„å®ç°"

æœ‰å“ªäº›åœºæ™¯éœ€è¦ç›´æ¥è°ƒç”¨_objc_msgForward?æœ€å¸¸è§çš„åœºæ™¯æ˜¯ï¼šä½ æƒ³è·å–æŸæ–¹æ³•æ‰€å¯¹åº”çš„NSInvocationå¯¹è±¡ã€‚ä¸¾ä¾‹è¯´æ˜ï¼š[JSPatchï¼ˆgithubé“¾æ¥)](https://github.com/bang590/JSPatch)å°±æ˜¯ç›´æ¥è°ƒç”¨äº†_objc_msgForwardæ¥å®ç°å…¶æ ¸å¿ƒåŠŸèƒ½çš„:
>JSPatchä»¥å°å·§çš„ä½“ç§¯åšåˆ°äº†è®©JSè°ƒç”¨/æ›¿æ¢ä»»æ„OCæ–¹æ³•ï¼Œè®©iOS APPå…·å¤‡çƒ­æ›´æ–°çš„èƒ½åŠ›ã€‚

ä½œè€…çš„åšæ–‡[ã€ŠJSPatchå®ç°åŸç†è¯¦è§£ã€‹](http://blog.cnbang.net/tech/2808/)è¯¦ç»†è®°å½•äº†å®ç°åŸç†ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹ã€‚

åŒæ—¶[_RAC_(ReactiveCocoa)](https://github.com/ReactiveCocoa/ReactiveCocoa)æºç ä¸­ä¹Ÿç”¨åˆ°äº†è¯¥æ–¹æ³•ã€‚


* ##2.èƒ½å¦å‘åç¼–è¯‘åå¾—åˆ°çš„ç±»ä¸­å¢åŠ å®ä¾‹å˜é‡ï¼Ÿèƒ½å¦å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ

1. ä¸èƒ½å‘ç¼–è¯‘åçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡
2. èƒ½å‘è¿è¡Œæ—¶åˆ›å»ºçš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡

è§£é‡Šä¸‹ï¼š

* å› ä¸ºç¼–è¯‘åçš„ç±»å·²ç»æ³¨å†Œåœ¨runtimeä¸­ï¼Œç±»ç»“æ„ä½“ä¸­çš„objc_ivar_listå®ä¾‹å˜é‡çš„é“¾è¡¨å’Œinstance_sizeå®ä¾‹å˜é‡çš„å†…å­˜å¤§å°å·²ç»ç¡®å®šï¼ŒåŒæ—¶runtimeä¼šè°ƒç”¨class_setIvarLayoutæˆ–class_setWeakIvarLayoutæ¥å¤„ç†strong weakå¼•ç”¨ã€‚æ‰€ä»¥ä¸èƒ½å‘å­˜åœ¨çš„ç±»ä¸­æ·»åŠ å®ä¾‹å˜é‡ï¼›
* è¿è¡Œæ—¶åˆ›å»ºçš„ç±»æ˜¯å¯ä»¥æ·»åŠ å®ä¾‹å˜é‡ï¼Œè°ƒç”¨class_addIvarå‡½æ•°ã€‚ä½†æ˜¯å¾—åœ¨è°ƒç”¨objc_allocateClassPairä¹‹åï¼Œobjc_registerClassPairä¹‹å‰ï¼ŒåŸå› åŒä¸Šã€‚

* ##3.runloopå’Œçº¿ç¨‹æœ‰ä»€ä¹ˆå…³ç³»

æ€»çš„æ¥è¯´ï¼ŒRun loopï¼Œæ­£å¦‚å…¶åï¼Œloopè¡¨ç¤ºæŸç§å¾ªç¯ï¼Œå’Œrunæ”¾åœ¨ä¸€èµ·å°±è¡¨ç¤ºä¸€ç›´åœ¨è¿è¡Œç€çš„å¾ªç¯ã€‚å®é™…ä¸Šï¼Œrun loopå’Œçº¿ç¨‹æ˜¯ç´§å¯†ç›¸è¿çš„ï¼Œå¯ä»¥è¿™æ ·è¯´run loopæ˜¯ä¸ºäº†çº¿ç¨‹è€Œç”Ÿçš„ï¼Œæ²¡æœ‰çº¿ç¨‹ï¼Œå®ƒå°±æ²¡æœ‰å­˜åœ¨çš„å¿…è¦ã€‚Run loopsæ˜¯çº¿ç¨‹çš„åŸºç¡€æ¶æ„éƒ¨åˆ†ï¼ŒCocoaå’ŒCoreFoundationéƒ½æä¾›äº†run loopå¯¹è±¡æ–¹ä¾¿é…ç½®å’Œç®¡ç†çº¿ç¨‹çš„run loop(ä»¥ä¸‹éƒ½ä»¥Cocoaä¸ºä¾‹)ã€‚æ¯ä¸ªçº¿ç¨‹ï¼ŒåŒ…æ‹¬ç¨‹åºçš„ä¸»çº¿ç¨‹(main thread)éƒ½ä¸ä¹‹ç›¸åº”çš„run loopå¯¹åº”ã€‚

runloopå’Œçº¿ç¨‹çš„å…³ç³»ï¼š

1.ä¸»çº¿ç¨‹çš„runloopé»˜è®¤æ˜¯å¯åŠ¨çš„ã€‚

iOSçš„åº”ç”¨ç¨‹åºé‡Œé¢ï¼Œç¨‹åºå¯åŠ¨åä¼šæœ‰ä¸€ä¸ªå¦‚ä¸‹çš„main()å‡½æ•°

	int main(int argc, char * argv[]) {
		@autoreleasepool {
			return UIAPPlicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class]));
		}
	}
	
é‡ç‚¹æ˜¯UIApplicationMain()å‡½æ•°ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šä¸ºmain threadè®¾ç½®ä¸€ä¸ªNSRunLoopå¯¹è±¡ï¼Œè¿™å°±è§£é‡Šäº†ï¼šä¸ºä»€ä¹ˆæˆ‘ä»¬çš„åº”ç”¨å¯ä»¥åœ¨æ— äººæ“ä½œçš„æ—¶å€™ä¼‘æ¯ï¼Œéœ€è¦è®©å®ƒå¹²æ´»çš„æ—¶å€™åˆèƒ½ç«‹é©¬å“åº”ã€‚

2.å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´ï¼Œrunloopé»˜è®¤æ˜¯ä¸å¯åŠ¨çš„ï¼Œå¦‚æœä½ éœ€è¦æ›´å¤šçš„çº¿ç¨‹äº¤äº’åˆ™å¯ä»¥æ‰‹åŠ¨é…ç½®å’Œå¯åŠ¨ï¼Œå¦‚æœçº¿ç¨‹è¿™æ˜¯å»æ‰§è¡Œä¸€ä¸ªé•¿æ—¶é—´çš„å·²ç¡®å®šçš„ä»»åŠ¡åˆ™ä¸éœ€è¦ã€‚
3.åœ¨ä»»ä½•ä¸€ä¸ªCocoaç¨‹åºçš„çº¿ç¨‹ä¸­ï¼Œéƒ½å¯ä»¥é€šè¿‡ä¸€ä¸‹ä»£ç æ¥è·å–åˆ°å½“å‰çº¿ç¨‹çš„runloopã€‚

	NSRunLoop * runloop = [NSRunLopp currentRunLoop];
	
å‚è€ƒé“¾æ¥[ã€ŠObjective-Cä¹‹runloopè¯¦è§£ã€‹](http://blog.csdn.net/wzzvictory/article/details/9237973)

* ##4. runloopçš„modeä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

modelä¸»è¦æ˜¯ç”¨æ¥æŒ‡å®šäº‹ä»¶åœ¨è¿è¡Œå¾ªç¯ä¸­çš„ä¼˜å…ˆçº§çš„ï¼Œåˆ†ä¸ºï¼š

1. NSDefaultRunLoopModeï¼ˆKCFRunLoopDefaultModeï¼‰
2. UITrackingRunLoopMode
3. UIInitializationRunLoopMode:å¯åŠ¨æ—¶
4. NSRunLoopCommonModes

è‹¹æœå…¬å¼€çš„Modeæœ‰ä¸¤ä¸ªï¼š defaultå’Œcommon

* ##5. ä»¥+ scheduledTimerWithTimerINterval...çš„æ–¹å¼è§¦å‘çš„timerï¼Œåœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼Œtimerä¼šæš‚å®šå›è°ƒï¼Œä¸ºä»€ä¹ˆï¼Ÿå¦‚ä½•è§£å†³
* ##6. çŒœæƒ³runloopå†…éƒ¨æ˜¯å¦‚ä½•å®ç°çš„ã€‚ [æ·±å…¥ç†è§£runloop](http://blog.ibireme.com/2015/05/18/runloop/#base)
* ##7.objcä½¿ç”¨ä»€ä¹ˆæœºåˆ¶ç®¡ç†å¯¹è±¡å†…å­˜

ä½¿ç”¨retainCountçš„æœºåˆ¶æ¥å†³å®šå¯¹è±¡æ˜¯å¦éœ€è¦é‡Šæ”¾ã€‚æ¯æ¬¡runloopçš„æ—¶å€™ï¼Œéƒ½æ˜¯æ£€æŸ¥å¯¹è±¡reatinCountï¼Œå¦‚æœretainCountä¸º0ï¼Œå°±é‡Šæ”¾ã€‚

* ##8.ARCé€šè¿‡ä»€ä¹ˆæ–¹å¼å¸®åŠ©å¼€å‘è€…ç®¡ç†å†…å­˜

ARCç›¸å¯¹äºMRCï¼Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶æ·»åŠ reatin/release/autorelease/è¿™ä¹ˆç®€å•ã€‚åº”è¯¥æ˜¯ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸä¸¤éƒ¨åˆ†å…±åŒå¸®åŠ©å¼€å‘è€…ç®¡ç†å†…å­˜ã€‚

åœ¨ç¼–è¯‘æœŸï¼ŒARCç”¨çš„æ˜¯æ›´åº•å±‚çš„Cæ¥å£å®ç°çš„reatin/release/autoreleaseï¼Œè¿™æ ·åšæ€§èƒ½æ›´å¥½ï¼Œä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ARCç¯å¢ƒä¸‹æ‰‹åŠ¨retain/release/autoreleaseã€‚åŒæ—¶å¯¹åŒä¸€ä¸Šä¸‹æ–‡çš„åŒä¸€å¯¹è±¡çš„æˆå¯¹reatin/releaseæ“ä½œè¿›è¡Œä¼˜åŒ–(æ—¢å¿½ç•¥æ‰ä¸å¿…è¦çš„æ“ä½œ)ï¼›ARCä¹ŸåŒ…å«è¿è¡ŒæœŸç»„ä»¶ï¼Œè¿™ä¸ªåœ°æ–¹åšçš„ä¼˜åŒ–æ¯”è¾ƒå¤æ‚ï¼Œä½†ä¹Ÿä¸èƒ½è¢«å¿½ç•¥

* ##9. ä¸æ‰‹åŠ¨æŒ‡å®šautoreleaseçš„å‰æä¸‹ï¼Œä¸€ä¸ªautoreleaseå¯¹è±¡åœ¨ä»€ä¹ˆæ—¶åˆ»é‡Šæ”¾ï¼Ÿ(æ¯”å¦‚åœ¨ä¸€ä¸ªVCçš„viewDidloadä¸­åˆ›å»º)

åˆ†ä¸¤ç§æƒ…å†µ:æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾æ—¶æœºã€ç³»ç»Ÿè‡ªåŠ¨é‡Šæ”¾ã€‚

1. æ‰‹åŠ¨å¹²é¢„é‡Šæ”¾æ—¶æœº--æŒ‡å®šautoreleaseå°±æ˜¯æ‰€è°“çš„ï¼šå½“å‰ä½œç”¨åŸŸå¤§æ‹¬å·ç»“æŸæ—¶é‡Šæ”¾ã€‚
2. ç³»ç»Ÿè‡ªåŠ¨å»é‡Šæ”¾--ä¸æ‰‹åŠ¨æŒ‡å®šautorelease

autoreleaseå¯¹è±¡å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«æ·»åŠ åˆ°æœ€è¿‘ä¸€æ¬¡åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå¹¶ä¼šåœ¨å½“å‰çš„runloopè¿­ä»£ç»“æŸæ—¶é‡Šæ”¾ã€‚

é‡Šæ”¾çš„æ—¶æœºæ€»ç»“èµ·æ¥ï¼Œå¯ä»¥ç”¨ä¸‹å›¾æ¥è¡¨ç¤º:

![](https://Jeremy1221.github.io/img/retain_cycle/autoreleasepool.png)

ä»ç¨‹åºå¯åŠ¨åˆ°åŠ è½½å®Œæˆæ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿è¡Œå¾ªç¯ï¼Œç„¶åä¼šåœä¸‹æ¥ï¼Œç­‰å¾…ç”¨æˆ·äº¤äº’ï¼Œç”¨æˆ·çš„æ¯ä¸€æ¬¡äº¤äº’éƒ½ä¼šå¯åŠ¨ä¸€æ¬¡è¿è¡Œå¾ªç¯ï¼Œæ¥å¤„ç†ç”¨æˆ·æ‰€æœ‰çš„ç‚¹å‡»äº‹ä»¶ï¼Œè§¦æ‘¸äº‹ä»¶ã€‚

æˆ‘ä»¬éƒ½çŸ¥é“ï¼šæ‰€æœ‰autoreleaseçš„å¯¹è±¡ï¼Œåœ¨å‡ºäº†ä½œç”¨åŸŸä¹‹åï¼Œä¼šè¢«è‡ªåŠ¨æ·»åŠ åˆ°æœ€è¿‘åˆ›å»ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚

ä½†æ˜¯å¦‚æœæ¯æ¬¡éƒ½æ”¾è¿›åº”ç”¨ç¨‹åºçš„main.mä¸­çš„autoreleasepoolä¸­ï¼Œè¿Ÿæ—©æœ‰è¢«æ’‘æ»¡çš„ä¸€åˆ»ã€‚è¿™ä¸ªè¿‡ç¨‹å¿…å®šæœ‰ä¸€ä¸ªé‡Šæ”¾çš„åŠ¨ä½œã€‚

åœ¨ä¸€æ¬¡å®Œæ•´çš„è¿è¡Œå¾ªç¯ä¹‹å‰ï¼Œä¼šè¢«é”€æ¯ã€‚è¿è¡Œå¾ªç¯æ£€æµ‹åˆ°äº‹ä»¶å¹¶å¯åŠ¨åï¼Œå°±æ˜¯åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚

å­çº¿ç¨‹runloopé»˜è®¤æ˜¯ä¸å·¥ä½œçš„ï¼Œæ— æ³•ä¸»åŠ¨åˆ›å»ºï¼Œå¿…é¡»æ‰‹åŠ¨åˆ›å»ºã€‚

è‡ªå®šä¹‰çš„NSOperationå’ŒNSThreadéœ€è¦æ‰‹åŠ¨åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚æ¯”å¦‚ï¼šè‡ªå®šä¹‰çš„NSOperationç±»ä¸­çš„mainæ–¹æ³•é‡Œå°±å¿…é¡»æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± ã€‚å¦åˆ™å‡ºäº†ä½œç”¨åŸŸåï¼Œè‡ªåŠ¨é‡Šæ”¾å¯¹è±¡ä¼šå› ä¸ºæ²¡æœ‰è‡ªåŠ¨é‡Šæ”¾æ± å»å¤„ç†å®ƒï¼Œè€Œé€ æˆäº†å†…å­˜æ³„æ¼ã€‚

ä½†å¯¹äºblockOperationå’ŒinvocationOperationè¿™ä¸­é»˜è®¤çš„Operationï¼Œç³»ç»Ÿå·²ç»å¸®æˆ‘ä»¬å°è£…å¥½äº†ï¼Œä¸éœ€è¦æ‰‹åŠ¨åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ã€‚

@autoreleasepoolå½“è‡ªåŠ¨é‡Šæ”¾æ± è¢«é”€æ¯æˆ–è€…è€—å°½æ—¶ï¼Œä¼šå‘è‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„æ‰€æœ‰å¯¹è±¡å‘é€ releaseæ¶ˆæ¯ï¼Œé‡Šæ”¾è‡ªåŠ¨é‡Šæ”¾æ± ä¸­çš„æ‰€æœ‰å¯¹è±¡ã€‚

å¦‚æœä¸€ä¸ªvcçš„viewDidloadä¸­åˆ›å»ºä¸€ä¸ªAutoreleaseå¯¹è±¡ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¼šåœ¨viewDidAppearæ–¹æ³•æ‰§è¡Œå‰å°±è¢«é”€æ¯äº†ã€‚

å‚è€ƒé“¾æ¥ï¼š[ã€Šé»‘å¹•èƒŒåçš„Autoreleaseã€‹](http://blog.sunnyxx.com/2014/10/15/behind-autorelease/)

* ##10. BAD_ACCESSåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å‡ºç°ï¼Ÿ

è®¿é—®äº†é‡æŒ‡é’ˆï¼Œæ¯”å¦‚å¯¹ä¸€ä¸ªå·²ç»é‡Šæ”¾çš„å¯¹è±¡æ‰§è¡Œäº†releaseã€è®¿é—®å·²ç»é‡Šæ”¾å¯¹è±¡çš„æˆå‘˜å˜é‡æˆ–è€…å‘æ¶ˆæ¯ã€‚æ­»å¾ªç¯ã€‚

* ##11. è‹¹æœå¦‚ä½•å®ç°autoreleasepoolçš„ï¼Ÿ

autoreleasepoolä»¥ä¸€ä¸ªé˜Ÿåˆ—æ•°ç»„çš„å½¢å¼å®ç°ï¼Œä¸»è¦é€šè¿‡ä¸‹åˆ—ä¸‰ä¸ªå‡½æ•°å®Œæˆã€‚

1. objc_autoreleasepoolPush
2. objc_autoreleasepoolPop
3. objc_autorelease

çœ‹å‡½æ•°åå°±çŸ¥é“ï¼Œå¯¹autoreleaseåˆ†åˆ«æ‰§è¡Œpushå’Œpopæ“ä½œï¼Œé”€æ¯å¯¹è±¡æ—¶æ‰§è¡Œäº†releaseæ“ä½œã€‚

ä¸¾ä¾‹è¯´æ˜ï¼šæˆ‘ä»¬çŸ¥é“ç”¨ç±»æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡éƒ½æ˜¯Autoreleaseçš„ï¼Œé‚£ä¹ˆä¸€æ—¦Personå‡ºäº†ä½œç”¨åŸŸï¼ŒæŒ¡åœ¨Personçš„deallocæ–¹æ³•ä¸­æ‰“ä¸Šæ–­ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°è¿™æ ·çš„è°ƒç”¨å †æ ˆä¿¡æ¯:

![](https://Jeremy1221.github.io/img/retain_cycle/autorelease.png)

* ##12. è°ƒç”¨blockæ—¶ä»€ä¹ˆæƒ…å†µä¼šå‘ç”Ÿå¼•ç”¨å¾ªç¯ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ
* ##13. åœ¨blockå†…å¦‚ä½•ä¿®æ”¹blockå¤–éƒ¨å˜é‡ï¼Ÿ

Blockä¸å…è®¸ä¿®æ”¹å¤–éƒ¨å˜é‡çš„å€¼ã€‚Appleè¿™æ ·è®¾è®¡ï¼Œåº”è¯¥æ˜¯è€ƒè™‘åˆ°äº†blockçš„ç‰¹æ®Šæ€§ï¼Œblockä¹Ÿå±äºâ€œå‡½æ•°â€çš„èŒƒç•´ï¼Œå˜é‡è¿›å…¥blockï¼Œå®é™…å°±æ˜¯å·²ç»æ”¹å˜äº†ä½œç”¨åŸŸã€‚åœ¨å‡ ä¸ªä½œç”¨åŸŸä¹‹é—´è¿›è¡Œåˆ‡æ¢æ—¶ï¼Œå¦‚æœä¸åŠ ä¸Šè¿™æ ·çš„é™åˆ¶ï¼Œå˜é‡çš„å¯ç»´æŠ¤æ€§å°†å¤§å¤§é™ä½ã€‚åˆæ¯”å¦‚æˆ‘æƒ³åœ¨blockå†…å£°æ˜ä¸€ä¸ªä¸å¤–éƒ¨åŒåçš„å˜é‡ï¼Œæ­¤æ—¶æ˜¯å…è®¸å‘¢è¿˜æ˜¯ä¸å…è®¸å‘¢ï¼Ÿåªæœ‰åŠ ä¸Šäº†è¿™æ ·çš„é™åˆ¶ï¼Œè¿™æ ·çš„æƒ…æ™¯æ‰èƒ½å®ç°ã€‚äºæ˜¯æ ˆåŒºå˜æˆäº†çº¢ç¯åŒºï¼Œå †åŒºå˜æˆäº†ç»¿ç¯åŒºã€‚

æˆ‘ä»¬å¯ä»¥æ‰“å°ä¸‹å†…å­˜åœ°å€æ¥è¿›è¡ŒéªŒè¯ï¼š

	__block int a = 0;
	NSLog(@"å®šä¹‰å‰:%p", &a);					//æ ˆåŒº
	void (^foo)(void) = ^ {
		a = 1;
		NSLog(@"block å†…éƒ¨: %p", &a);		//å †åŒº
	}ï¼›
	NSLog(@"å®šä¹‰å:%p", &a);					//å †åŒº
	foo();
	
	å®šä¹‰å‰ï¼š0x16fda86f8
	å®šä¹‰åï¼š0x155b22fc8
	blockå†…éƒ¨ï¼š 0x155b22fc8
	
blockçš„å†…éƒ¨å˜é‡ä¼šè¢«copyåˆ°å †åŒºï¼Œâ€œblockå†…éƒ¨â€æ‰“å°çš„æ˜¯å †åœ°å€ï¼Œå› è€Œä¹Ÿå°±å¯ä»¥çŸ¥é“ï¼Œâ€œå®šä¹‰åâ€æ‰“å°çš„ä¹Ÿæ˜¯å †çš„åœ°å€ã€‚

é‚£ä¹ˆå¦‚ä½•è¯æ˜â€œblockå†…éƒ¨â€æ‰“å°çš„æ˜¯å †åœ°å€ï¼Ÿ

æŠŠä¸‰ä¸ª16è¿›åˆ¶çš„å†…å­˜åœ°å€è½¬æˆ10è¿›åˆ¶å°±æ˜¯ï¼š

1.å®šä¹‰å‰ï¼š6171559672

2.blockå†…éƒ¨ï¼š5732708296

3.å®šä»¥åï¼š5732708296

ä¸­é—´ç›¸å·®438851376ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯418.5Mçš„ç©ºé—´ï¼Œå› ä¸ºå †åœ°å€è¦å°äºæ ˆåœ°å€ï¼Œåˆå› ä¸ºiOSä¸­ä¸€ä¸ªè¿›ç¨‹çš„æ ˆåŒºå†…å­˜åªæœ‰1Mï¼ŒMacä¹Ÿåªæœ‰8Mï¼Œæ˜¾ç„¶aå·²ç»æ˜¯åœ¨å †åŒºäº†ã€‚

è¿™ä¹Ÿè¯å®äº†ï¼šaåœ¨å®šä¹‰å‰æ˜¯æ ˆåŒºï¼Œä½†åªè¦è¿›å…¥äº†blockåŒºåŸŸï¼Œå°±å˜æˆäº†å †åŒºã€‚è¿™æ‰æ˜¯__blockå…³é”®å­—çš„çœŸæ­£ä½œç”¨ã€‚

__blockå…³é”®å­—ä¿®é¥°åï¼Œintç±»å‹ä¹Ÿä»4å­—èŠ‚å˜æˆäº†32å­—èŠ‚ï¼Œè¿™æ˜¯Foundationæ¡†æ¶mallocå‡ºæ¥çš„ã€‚è¿™ä¹ŸåŒæ ·èƒ½è¯å®ä¸Šé¢çš„ç»“è®ºã€‚ï¼ˆPSï¼šå±…ç„¶æ¯”NSObject allocå‡ºæ¥çš„16å­—èŠ‚è¦å¤šä¸€å€ï¼‰ã€‚

ç†è§£åˆ°è¿™æ˜¯å› ä¸ºå †æ ˆåœ°å€çš„å˜æ›´ï¼Œè€Œéæ‰€è°“çš„â€œå†™æ“ä½œç”Ÿæ•ˆâ€ï¼Œè¿™ä¸€ç‚¹è‡³å…³é‡è¦ï¼Œè¦ä¸ç„¶å¦‚ä½•è§£é‡Šä¸‹é¢è¿™ä¸€ç°è±¡:

ä¸€ä¸‹ä»£ç ç¼–è¯‘å¯é€šè¿‡ï¼Œå¹¶ä¸”åœ¨blockä¸­æˆåŠŸå°†açš„å€¼ä»Tomä¿®æ”¹ä¸ºJerryã€‚

	NSMutableString * a = [NSMutableString stringWithString:@"Tom"];
	NSLog(@"\n å®šä¹‰å‰------------------\n\aæŒ‡å‘å‰çš„å †ä¸­åœ°å€ï¼š%Pï¼›aåœ¨æ ˆä¸­æŒ‡é’ˆåœ°å€ï¼š%p", a, &a);
	
	void(^foo)(void)= ^{
		a.string = @"Jerry";
		NSLog(@"\n blockå†…éƒ¨ï¼š---------------------\n\aæŒ‡å‘çš„å †ä¸­çš„åœ°å€ï¼š%pï¼›aåœ¨æ ˆä¸­çš„æŒ‡é’ˆåœ°å€ï¼š%p", a, &a);
		a = [NSMutableString stringWithString:@"William"];
	}
	foo();
	NSLog(@"\n å®šä¹‰å--------------------\n\aæŒ‡å‘çš„å †ä¸­çš„åœ°å€ï¼š%pï¼›aåœ¨æ ˆä¸­çš„æŒ‡é’ˆåœ°å€ï¼š%p", a, &a);

![](https://Jeremy1221.github.io/img/retain_cycle/block_result.png)

è¿™é‡Œçš„aå·²ç»ç”±åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå˜æˆäº†å¯¹è±¡ç±»å‹ã€‚blockä¼šå¯¹å¯¹è±¡ç±»å‹çš„æŒ‡é’ˆè¿›è¡Œcopyï¼Œcopyåˆ°å †ä¸­ï¼Œä½†å¹¶ä¸ä¼šæ”¹å˜æŒ‡é’ˆæ‰€æŒ‡å‘å †ä¸­çš„åœ°å€ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œblockä½“å†…ä¿®æ”¹çš„å®é™…æ˜¯aæŒ‡å‘çš„å †ä¸­çš„å†…å®¹ã€‚

ä½†å¦‚æœæˆ‘ä»¬å°è¯•å‘ä¸Šé¢å›¾ç‰‡ä¸­çš„65è¡Œé‚£æ ·åšï¼Œç»“æœä¼šç¼–è¯‘ä¸é€šè¿‡ï¼Œé‚£æ˜¯å› ä¸ºæ­¤æ—¶ä½ åœ¨ä¿®æ”¹çš„å°±ä¸æ˜¯å †ä¸­çš„å†…å®¹ï¼Œè€Œæ˜¯æ ˆä¸­çš„å†…å®¹ã€‚

* ##14. ä½¿ç”¨ç³»ç»Ÿçš„æŸäº›block API(å¦‚UIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶)ï¼Œæ˜¯å¦ä¹Ÿè€ƒè™‘å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Ÿ

ç³»ç»Ÿçš„æŸäº›block apiä¸­ï¼ŒUIViewçš„blockç‰ˆæœ¬å†™åŠ¨ç”»æ—¶ä¸éœ€è¦è€ƒè™‘ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›apiéœ€è¦è€ƒè™‘ï¼š

å¦‚æœä½ ä½¿ç”¨ä¸€äº›å‚æ•°ä¸­å¯èƒ½å«æœ‰ivarçš„ç³»ç»Ÿapiï¼Œå¦‚GCDã€NSNotificationCenterå°±è¦å°å¿ƒä¸€ç‚¹ï¼šæ¯”å¦‚GCDå†…éƒ¨å¦‚æœå¼•ç”¨äº†selfï¼Œè€Œä¸”GCDçš„å…¶ä»–å‚æ•°æ˜¯ivarï¼Œåˆ™è¦è€ƒè™‘åˆ°å¾ªç¯å¼•ç”¨ï¼š

	__weak __typeof(__self) weakSelf = self;
	dispatch_group_async(_operationsGroup, _operationsQueue, ^{
		__typeof__(self) strongSelf = weakSelf;
		[strongSelf doSomething];
		[strongSelf doSomethingElse];
	});
	
ç±»ä¼¼çš„ï¼š

	__weak __typeof__(self) weakSelf = self;
	
	_obsever = [[NSNotificationCenter defaultCenter] addObserverForName:@"testKey" object:nil queue:nil usingBlock:^(NSNotification * note){
		__typeof__(self) strongSelf = wealSelf;
		[strongSelf dismissModalViewContronllerAnimated:YES];
	}];
	
self->_observer->block->selfæ˜¾ç„¶è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ªç¯å¼•ç”¨ã€‚

* ##15. GCDçš„é˜Ÿåˆ—åˆ†å“ªä¸¤ç§ç±»å‹ï¼Ÿ

1.ä¸²è¡Œé˜Ÿåˆ—Serial Dispatch Queue
2.å¹¶è¡Œé˜Ÿåˆ—Concurrent Dispatch Queue

* ##16. å¦‚ä½•ç”¨GCDåŒæ­¥è‹¥å¹²ä¸ªå¼‚æ­¥è°ƒç”¨ï¼Ÿï¼ˆå¦‚æ ¹æ®è‹¥å¹²ä¸ªurlå¼‚æ­¥åŠ è½½å¤šå¼ å›¾ç‰‡ï¼Œç„¶ååœ¨éƒ½ä¸‹è½½å®Œæˆååˆæˆä¸€å¼ æ•´å›¾ï¼‰

ä½¿ç”¨Dispatch Groupè¿½åŠ blockåˆ°Global Group Queueï¼Œè¿™äº›blockå¦‚æœå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œå°±ä¼šæ‰§è¡ŒMain Dispatch Queueä¸­çš„

	dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
	dispatch_group_t group = dispatch_group_create();
	dispatch_group_async(group, queue^{/*åŠ è½½å›¾ç‰‡1*/});
	dispatch_group_async(group, queue^{/*åŠ è½½å›¾ç‰‡2*/});
	dispatch_group_async(group, queue^{/*åŠ è½½å›¾ç‰‡3*/});
	dispatch_group_notify(group, dispatch_get_main_queue(), ^{/*åˆå¹¶å›¾ç‰‡*/});

* ##17. dispatch_barrier_asyncdeçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

åœ¨å¹¶è¡Œé˜Ÿåˆ—ä¸­ï¼Œä¸ºäº†ä¿æŒæŸäº›ä»»åŠ¡çš„é¡ºåºï¼Œéœ€è¦ç­‰å¾…ä¸€äº›ä»»åŠ¡å®Œæˆåæ‰èƒ½ç»§ç»­è¿›è¡Œï¼Œä½¿ç”¨barrieræ¥ç­‰å¾…ä¹‹å‰ä»»åŠ¡å®Œæˆï¼Œé¿å…æ•°æ®ç«äº‰ç­‰é—®é¢˜ã€‚dispatch_barrier_asyncå‡½æ•°ä¼šç­‰å¾…è¿½åŠ åˆ°Concurrent Dispatch Queueå¹¶è¡Œé˜Ÿåˆ—ä¸­çš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œä¹‹åï¼Œç„¶åå†æ‰§è¡Œdispatch_barrier_asyncå‡½æ•°è¿½åŠ çš„å¤„ç†ï¼Œç­‰dispatch_barrier_asyncè¿½åŠ çš„å¤„ç†æ‰§è¡Œç»“æŸä¹‹åï¼ŒConcurrent Dispatch Queueæ‰æ¢å¤ä¹‹å‰çš„åŠ¨ä½œç»§ç»­æ‰§è¡Œã€‚

ï¼ˆæ³¨æ„ï¼šä½¿ç”¨dispatch_barrier_asyncï¼Œè¯¥å‡½æ•°åªèƒ½æ­é…è‡ªå®šä¹‰å¹¶è¡Œé˜Ÿåˆ—dispatch_queue_tä½¿ç”¨ã€‚ä¸èƒ½ä½¿ç”¨dispatch_get_global_queue,å¦åˆ™dispatch_barrier_asyncçš„ä½œç”¨ä¼šå’Œdispatch_asyncçš„ä½œç”¨ä¸€æ¨¡ä¸€æ ·ã€‚ï¼‰

* ##18. è‹¹æœä¸ºä»€ä¹ˆè¦åºŸå¼ƒdispatch_get_current_queueï¼Ÿ

dispatch_get_current_queueå®¹æ˜“é€ æˆæ­»é”

* ##19. ä»¥ä¸‹ä»£ç è¿è¡Œç»“æœå¦‚ä½•

		- (void)viewDidload {
			[super viewDidload];
			NSLog(@"1");
			dispatch_sync(dispatch_get_main_queue(), ^{
				NSLog(@"2");
			});
			NSLog(@"3");
		}

åªè¾“å‡º1ï¼Œå‘ç”Ÿä¸»çº¿ç¨‹é”æ­»ã€‚

* ##20. addObserver:forKeyPath:options:context:å„ä¸ªå‚æ•°çš„ä½œç”¨åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œobserverä¸­éœ€è¦å®ç°å“ªä¸ªæ–¹æ³•æ‰èƒ½è·å¾—KVOå›è°ƒï¼Ÿ

		//æ·»åŠ é”®å€¼è§‚å¯Ÿ
		/*
		1 è§‚å¯Ÿè€…ï¼Œè´Ÿè´£å¤„ç†ç›‘å¬äº‹ä»¶çš„å¯¹è±¡
		2 è§‚å¯Ÿçš„å±æ€§
		3 è§‚å¯Ÿçš„é€‰é¡¹
		4 ä¸Šä¸‹æ–‡
		*/
		[self.person addObserver:self forKeyPath:@"" options:NSKeyValueObservingOptioneNew | NSKeyValueObservingOptionOld context:@""];
		
observerä¸­éœ€è¦å®ç°ä»¥ä¸‹æ–¹æ³•ï¼š

	// æ‰€æœ‰çš„kvoç›‘å¬åˆ°äº‹ä»¶ï¼Œéƒ½ä¼šè°ƒç”¨æ­¤æ–¹æ³•
	/*
	1 è§‚å¯Ÿçš„å±æ€§
	2 è§‚å¯Ÿçš„å¯¹è±¡
	3 changeå±æ€§å˜åŒ–å­—å…¸(æ–°/æ—§)
	4 ä¸Šä¸‹æ–‡ï¼Œä¸ç›‘å¬çš„æ—¶å€™ä¼ é€’çš„ä¸€è‡´
	*/
	- (void)observerValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary*)change context:(void*)context;
		
* ##21. å¦‚ä½•æ‰‹åŠ¨è§¦å‘ä¸€ä¸ªvalueçš„KVO

æ‰€è°“çš„â€œæ‰‹åŠ¨è§¦å‘â€æ˜¯åŒºåˆ«äºâ€œè‡ªåŠ¨è§¦å‘â€ï¼š

è‡ªåŠ¨è§¦å‘æ˜¯æŒ‡ç±»ä¼¼è¿™ç§åœºæ™¯ï¼šåœ¨æ³¨å†ŒKVOä¹‹å‰è®¾ç½®ä¸€ä¸ªåˆå§‹å€¼ï¼Œæ³¨å†Œä¹‹åï¼Œè®¾ç½®ä¸€ä¸ªä¸ä¸€æ ·çš„å€¼ï¼Œå°±å¯ä»¥è§¦å‘äº†ã€‚

æƒ³çŸ¥é“å¦‚ä½•æ‰‹åŠ¨è§¦å‘ï¼Œå°±å¿…é¡»çŸ¥é“KVOçš„è§¦å‘åŸç†ï¼š

é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äºNSObjectçš„ä¸¤ä¸ªæ–¹æ³•willChangValueForKey:å’ŒdidChangeValueForKey:ã€‚åœ¨ä¸€ä¸ªè¢«è§‚å¯Ÿè€…å±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKey:ä¸€å®šä¼šè¢«è°ƒç”¨ï¼Œè¿™å°±ä¼šè®°å½•æ—§çš„å€¼ã€‚è€Œå½“æ”¹å˜å‘ç”Ÿåï¼ŒobserverValueForKey:forKey:ofObject:change:content:ä¼šè¢«è°ƒç”¨ï¼Œç»§è€ŒdidChangeValueForKey:ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚å¦‚æœå¯ä»¥æ‰‹åŠ¨å®ç°è¿™äº›è°ƒç”¨ï¼Œå°±å¯ä»¥å®ç°"æ‰‹åŠ¨è§¦å‘"äº†ã€‚

é‚£ä¹ˆâ€œæ‰‹åŠ¨è§¦å‘â€çš„ä½¿ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿä¸€èˆ¬æˆ‘ä»¬åªåœ¨å¸Œæœ›èƒ½æ§åˆ¶â€œå›è°ƒçš„è°ƒç”¨æ—¶æœºâ€æ—¶æ‰ä¼šè¿™ä¹ˆåšã€‚

å…·ä½“åšæ³•å¦‚ä¸‹ï¼š

å¦‚æœè¿™ä¸ªvalueæ˜¯è¡¨ç¤ºæ—¶é—´çš„self.now,é‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼šæœ€åä¸¤è¡Œç¼ºä¸€ä¸å¯ã€‚

ç›¸å…³ä»£ç å·²æ”¾åœ¨ä»“åº“é‡Œã€‚

	//@property (nonatomic, strong)NSDate * now;
	- (void)viewDidLoad {
		[super viewDidLoad];
		_now = [NSDate date];
		[self addObserver:self forKeyPath:@"now" options:NSKeyValueObservingOptionNew contenxt:nil];
		NSLog(@"1");
		[self willChangeValueForKey:@"now"];
		NSLog(@"2");
		[self didChangeValueForkey:@"now"];
		NSLog(@"3");
	}

ä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šè¿™ä¹ˆå¹²ï¼Œæˆ‘ä»¬éƒ½æ˜¯ç­‰ç³»ç»Ÿå»â€œè‡ªåŠ¨è§¦å‘â€ã€‚â€œè‡ªåŠ¨è§¦å‘â€çš„å®ç°åŸç†ï¼š
>æ¯”å¦‚è°ƒç”¨setNow:æ—¶ï¼Œç³»ç»Ÿè¿˜ä¼šä»¥æŸç§æ–¹å¼åœ¨ä¸­é—´æ’å…¥willChangeValueForKey:ã€didChangeValueForKey:å’ŒobserveValueForKeyPath:ofObject:change:context:çš„è°ƒç”¨ã€‚

å¤§å®¶å¯èƒ½ä»¥ä¸ºè¿™æ˜¯å› ä¸ºsetNow:æ˜¯åˆæˆæ–¹æ³•ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿèƒ½çœ‹åˆ°æœ‰äººè¿™ä¹ˆå†™ä»£ç ï¼š

	- (void)setNow:(NSDate *)now {
		[self willChangeValueForKey:@"now"];
		_now = now;
		[self didChangeValueForKey:@"now"];
	}
	
ä¼šè°ƒä¸¤æ¬¡ã€‚[å‚è€ƒé“¾æ¥Manual Change Notification---Appleå®˜æ–¹æ–‡æ¡£](https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/KeyValueObserving/Articles/KVOCompliance.html#//apple_ref/doc/uid/20002178-SW3)

* ##22. è‹¥ä¸€ä¸ªç±»æœ‰å®ä¾‹å˜é‡ NSString * _foo,è°ƒç”¨setValue:forKey:æ—¶ï¼Œå¯ä»¥ä»¥fooè¿˜æ˜¯_fooä½œä¸ºkeyï¼Ÿ

éƒ½å¯ä»¥ã€‚

* ##23. KVCçš„keyPathä¸­çš„é›†åˆè¿ç®—ç¬¦å¦‚ä½•ä½¿ç”¨ï¼Ÿ

1.å¿…é¡»ç”¨åœ¨é›†åˆå¯¹è±¡ä¸Šæˆ–æ™®é€šå¯¹è±¡çš„é›†åˆå±æ€§ä¸Š
2.ç®€å•é›†åˆè¿ç®—ç¬¦æœ‰@avg,@count,@max,@min,@sum,
3.æ ¼å¼@"@sum.age"æˆ–@"é›†åˆå±æ€§.@max.age"

	@interface Person: NSObject
	@property (nonatomic, assign) NSinteger age;
	@end
	
	- (void)viewDidLoad {
		[super viewDidLoad];
	
		Person *p2 = [[Person alloc] initWithName:@"xiaoming" andAge:15];
    	Person *p3 = [[Person alloc] initWithName:@"xiaohong" andAge:20];
		Person *p4 = [[Person alloc] initWithName:@"xiaoli" andAge:30];
    	Person *p5 = [[Person alloc] initWithName:@"xiaoli" andAge:55];
	}
	
	NSArray *perArray = @[p1, p2, p3, p4, p5];
     
     // ç®€å•é›†åˆè¿ç®—ç¬¦
     NSInteger avg = [[perArray valueForKeyPath:@"@avg.age"] integerValue];
     NSInteger sum = [[perArray valueForKeyPath:@"@sum.age"] integerValue];
     NSInteger max = [[perArray valueForKeyPath:@"@max.age"] integerValue];
     NSInteger min = [[perArray valueForKeyPath:@"@min.age"] integerValue];

* ##24. KVCå’ŒkVOçš„keyPathä¸€å®šæ˜¯å±æ€§å—ï¼Ÿ

KVCæ”¯æŒå®ä¾‹å˜é‡ï¼ŒKVOåªèƒ½æ‰‹åŠ¨æ”¯æŒ[æ‰‹åŠ¨è®¾å®šå®ä¾‹å˜é‡çš„KVOå®ç°ç›‘å¬](https://yq.aliyun.com/articles/30483)

* ##25. å¦‚ä½•å…³é—­é»˜è®¤çš„KVOçš„é»˜è®¤å®ç°ï¼Œå¹¶è¿›å…¥è‡ªå®šä¹‰çš„KVOå®ç°

1.[å¦‚ä½•è‡ªå·±æ‰‹åŠ¨å®ç°KVO](http://tech.glowing.com/cn/implement-kvo/)

2.[KVO for manually implemented properties](http://stackoverflow.com/a/10042641/3395008)

* ##26. appleç”¨ä»€ä¹ˆæ–¹å¼å®ç°å¯¹ä¸€ä¸ªå¯¹è±¡çš„KVOï¼Ÿ

Appleçš„æ–‡æ¡£å¯¹KVOå®ç°çš„æè¿°ï¼š
>Automatic Key-value observing is implemented using a technique called isa-swizzling... When an observer is registerd for an attribute of an object the isa pointer of the observed object is modified, point to an intermediate class rather than at the true class...

ä»Appleçš„æ–‡æ¡£å¯ä»¥çœ‹å‡ºï¼šAppleå¹¶ä¸å¸Œæœ›è¿‡å¤šæš´éœ²KVOçš„å®ç°ç»†èŠ‚ã€‚ä¸è¿‡ï¼Œè¦æ˜¯å€ŸåŠ©runtimeæä¾›çš„æ–¹æ³•å»æ·±å…¥æŒ–æ˜ï¼Œæ‰€æœ‰è¢«æ©ç›–çš„ç»†èŠ‚éƒ½ä¼šåŸå½¢æ¯•éœ²ï¼š
>å½“ä½ è§‚å¯Ÿä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¸€ä¸ªæ–°çš„ç±»ä¼šè¢«åŠ¨æ€åˆ›å»ºã€‚è¿™ä¸ªç±»ç»§æ‰¿è‡ªè¯¥å¯¹è±¡çš„åŸæœ¬çš„ç±»ï¼Œå¹¶é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§çš„setteræ–¹æ³•ã€‚é‡å†™çš„setteræ–¹æ³•ä¼šè´Ÿè´£åœ¨è°ƒç”¨åŸsetteræ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿå¯¹è±¡:å€¼çš„æ›´æ”¹ã€‚æœ€åé€šè¿‡isaæ··å†™(isa-swizzling)æŠŠè¿™ä¸ªå¯¹è±¡çš„isaæŒ‡é’ˆ(isaæŒ‡é’ˆå‘Šè¯‰Runtimeç³»ç»Ÿè¿™ä¸ªå¯¹è±¡çš„ç±»æ˜¯ä»€ä¹ˆ)æŒ‡å‘è¿™ä¸ªæ–°åˆ›å»ºçš„å­ç±»ï¼Œå¯¹è±¡å°±ç¥å¥‡çš„å˜æˆäº†æ–°åˆ›å»ºçš„å­ç±»çš„å®ä¾‹ã€‚æˆ‘ç”»äº†ä¸€å¼ ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

* ##27. IBOutletè¿å‡ºæ¥çš„è§†å›¾å±æ€§ä¸ºä»€ä¹ˆå¯ä»¥è¢«è®¾ç½®æˆweak

å‚è€ƒé“¾æ¥:[Should IBOutlets be strong or weak under ARC](http://stackoverflow.com/questions/7678469/should-iboutlets-be-strong-or-weak-under-arc)

æ–‡ç« å‘Šè¯‰æˆ‘ä»¬ï¼š
>å› ä¸ºæ—¢ç„¶æœ‰å¤–é“¾é‚£ä¹ˆè§†å›¾åœ¨xibæˆ–è€…storyboardä¸­è‚¯å®šå­˜åœ¨ï¼Œè§†å›¾å·²ç»å¯¹å®ƒæœ‰ä¸€ä¸ªå¼ºå¼•ç”¨äº†ã€‚

ä¸è¿‡è¿™ä¸ªå›ç­”æ¼äº†ä¸ªé‡è¦çŸ¥è¯†ï¼Œä½¿ç”¨storyboard(xibä¸è¡Œ)åˆ›å»ºçš„vcï¼Œä¼šæœ‰ä¸€ä¸ªå«_topLevelObjectsToKeepAliveFromStoryboardçš„ç§æœ‰æ•°ç»„å¼ºå¼•ç”¨æ‰€æœ‰toplevelçš„å¯¹è±¡ï¼Œæ‰€ä»¥è¿™æ˜¯å³ä¾¿outletå£°æ˜æˆweakä¹Ÿæ²¡å…³ç³»

* ##28. IBä¸­User Defined Runtime Attributeså¦‚ä½•ä½¿ç”¨ï¼Ÿ

å®ƒèƒ½å¤Ÿé€šè¿‡KVCçš„æ–¹å¼é…ç½®ä¸€äº›ä½ å†Interface builderä¸­ä¸èƒ½é…ç½®çš„å±æ€§ã€‚å½“ä½ å¸Œæœ›åœ¨IBä¸­ä½œå°½å¯èƒ½å¤šçš„äº‹æƒ…ï¼Œè¿™ä¸ªç‰¹æ€§èƒ½å¤Ÿå¸®åŠ©ä½ ç¼–å†™æ›´åŠ è½»é‡çš„viewcontrollerã€‚

* ##29. å¦‚ä½•è°ƒè¯•BAD_ACCESSé”™è¯¯

1.é‡å†™objectçš„respondsToSelectoræ–¹æ³•ï¼Œç°å®å‡ºç°EXEC_BAD_ACCESSå‰è®¿é—®çš„æœ€åä¸€ä¸ªobject

2.é€šè¿‡zombie

3.è®¾ç½®å…¨å±€æ–­ç‚¹å¿«é€Ÿå®šä½é—®é¢˜ä»£ç æ‰€åœ¨è¡Œ

4.Xcode7å·²ç»é›†æˆäº†BAD_ACCESSæ•è·åŠŸèƒ½ï¼šAddress Sanitizerã€‚ç”¨æ³•å¦‚ä¸‹ï¼šåœ¨é…ç½®ä¸­å‹¾é€‰âœ…Enable Address Sanitizer

* ##30. llgd(gdb)å¸¸ç”¨çš„è°ƒè¯•å‘½ä»¤ï¼Ÿ

1.breakpointè®¾ç½®æ–­ç‚¹å®šä½åˆ°æŸä¸€ä¸ªå‡½æ•°

2.næ–­ç‚¹æŒ‡é’ˆä¸‹ä¸€æ­¥

3.poæ‰“å°å¯¹è±¡

æ›´llgd(gdb)è°ƒè¯•å‘½ä»¤å¯æŸ¥çœ‹

1.[The LLDB Debugger](http://lldb.llvm.org/lldb-gdb.html)

2.è‹¹æœå®˜æ–¹æ–‡æ¡£[iOS Debugging Magic](https://developer.apple.com/library/ios/technotes/tn2239/_index.html)

#new interview test 3


